# ç½‘ç»œ

## URL

Uniform Resource Locator(ç»Ÿä¸€èµ„æºå®šä½ç¬¦)ï¼Œç½‘ç»œä¸­æ¯ä¸€ä¸ªèµ„æºéƒ½å¯¹åº”å”¯ä¸€çš„åœ°å€â€”URLã€‚

- URLçš„åŸºæœ¬æ ¼å¼

  - åè®®://ä¸»æœºåœ°å€:ç«¯å£å·/è·¯å¾„

    - åè®®ï¼š ä¸åŒçš„åè®®ä»£è¡¨ä¸åŒçš„èµ„æºè·å–æ–¹å¼

    - ä¸»æœºåœ°å€ï¼šä¸»æœºçš„å”¯ä¸€æ ‡ç¤º(IPåœ°å€ã€åŸŸå)

    - è·¯å¾„ï¼šèµ„æºåœ¨ä¸»æœºä¸­çš„å…·ä½“ä½ç½®

  - ä¸¾ä¾‹ï¼š

    - http://www.itheima.com/
    - http://www.itheima.com/images/xx00.png
    - ftp://www.itheima.com/movies/cls.avi

- URLçš„å¸¸è§åè®®

- -  HTTPã€FTPã€mailtoã€Fileã€tel://ã€sms://

## HTTPç®€ä»‹

- HyperText Transport Protocol(è¶…æ–‡æœ¬ä¼ è¾“åè®®)
  - æµè§ˆå™¨å’ŒWebæœåŠ¡å™¨é€šè®¯æ—¶å€™éµå®ˆçš„çº¦å®š
  - äº’è”ç½‘ä½¿ç”¨æœ€å¤šçš„åè®®
  - æä¾›è¶…æ–‡æœ¬ä¼ è¾“æœåŠ¡
  - é€šè¿‡æµè§ˆå™¨æ‰“å¼€ç½‘ç«™ä½¿ç”¨çš„å°±æ˜¯HTTPæä¾›çš„æœåŠ¡ï¼Œå¼€å‘Appä¹Ÿä¼šç»å¸¸ä½¿ç”¨HTTPåè®®ä»ç½‘ç»œä¸Šè·å–æ•°æ®

- ### TCPå’ŒUDP

- ç®€å•æ¥è¯´TCPåè®®ä¼ è¾“å¾—åˆ°çš„æ•°æ®æ˜¯æ­£ç¡®çš„ï¼Œè€ŒUDPå¾—åˆ°çš„æ•°æ®æ˜¯æœ‰å¯èƒ½æœ‰é—®é¢˜çš„ï¼Œå› ä¸ºTCPåœ¨ç½‘ç»œå±‚çš„åè®®ä¸€å®šæœ‰æ ¡éªŒç ï¼Œè€ŒUDPæ˜¯ä¸ä¸€å®šè¦æ ¡éªŒç çš„ï¼Œå› æ­¤æ— æ³•ç¡®ä¿100%æ­£ç¡®ï¼Œç°åœ¨é˜¶æ®µçš„ç½‘ç»œä¼ è¾“è¯¯ç ç‡æ˜¯éå¸¸éå¸¸ä½çš„ï¼Œå› æ­¤UDPä¹Ÿè¿˜æ˜¯ä¸é”™çš„é€‰æ‹©

- TCP: è¦æ±‚å¯é æ€§é«˜çš„æ—¶å€™ç”¨ï¼Œå› ä¸ºTCPåœ¨å»ºç«‹è¿æ¥å™¨è¦ç»è¿‡ä¸‰æ¬¡é€šä¿¡æ‰ä¼šå»ºç«‹è¿æ¥é€šé“ï¼Œå¹¶ä¸”æ ¡éªŒå‘ç°é”™è¯¯ä¼šè¦æ±‚é‡å‘ã€‚ï¼ˆæ¯”å¦‚ä¸‹è½½ï¼‰

- UDP: è¦æ±‚å®æ—¶æ€§æ¯”è¾ƒé«˜ï¼Œç»æµå®æƒ çœæµé‡çš„æ—¶å€™ä½¿ç”¨ã€‚ç›´æ¥å°±å»ºç«‹è¿æ¥çš„é€šé“ï¼Œæ•°æ®é”™è¯¯ä¹Ÿä¸ä¼šè¦æ±‚é‡å‘ï¼ˆæ¯”å¦‚æ‰“ç”µè¯ï¼Œç›´æ’­ï¼‰

## Socketï¼ˆå¥—æ¥å­—ï¼‰


Socketåˆç§°â€œå¥—æ¥å­—â€ï¼Œåº”ç”¨ç¨‹åºé€šè¿‡â€œå¥—æ¥å­—â€å‘ç½‘ç»œå‘é€è¯·æ±‚æˆ–å‘ç½‘ç»œåšå‡ºåº”ç­”ã€‚

ç½‘ç»œé€šä¿¡å…¶å®å°±Socketä¹‹é—´çš„é€šä¿¡ï¼Œæ•°æ®åœ¨ä¸¤ä¸ªSocketä¹‹é—´é€šè¿‡IOä¼ è¾“æ•°æ®ï¼ŒSocketæ˜¯çº¯Cè¯­è¨€çš„ï¼Œæ˜¯è·¨å¹³å°çš„ï¼Œ**HTTPåè®®æ˜¯åŸºäºSocketçš„ï¼ŒHTTPåè®®çš„åº•å±‚ä½¿ç”¨çš„å°±æ˜¯Socket**ã€‚Socketå°±æ˜¯åœ¨åº”ç”¨å±‚å’Œä¼ è¾“å±‚ä¹‹é—´çš„åè®®ã€‚

**Socketçš„é€šä¿¡è¿‡ç¨‹**ï¼š

- åˆ›å»ºSocket

  - å¯¼å…¥å¤´æ–‡ä»¶
    - \#import <sys/socket.h>
    - \#import <netinet/in.h>
    - \#import <arpa/inet.h>

  - åˆ›å»ºSocket`int socket(int domain, int type, int protocol);`
    - å‚æ•°1 domain åè®®åŸŸ AF_INET--IPV4
    - å‚æ•°2 type  socketç±»å‹ SOCK_STREAM(TCP)/SOCKET_DGRAM(UDP)
    - å‚æ•°3 protocol IPPROTO_TCP/IPPROTO_UDP  å¦‚æœ ä¼ å…¥0 ä¼šæ ¹æ®ç¬¬äºŒä¸ªå‚æ•°é€‰æ‹©åˆé€‚çš„å€¼
    - è¿”å›å€¼ >0 åˆ›å»ºæˆåŠŸ socketçš„æè¿°ç¬¦

  - ç¤ºä¾‹ï¼šint clientSocket = socket(AF_INET, SOCK_STREAM, IPPROTO_TCP);

- è¿æ¥åˆ°æœåŠ¡å™¨

  - å®šä¹‰å‡½æ•°ï¼šint connect(int sockfd, struct sockaddr * serv_addr, int addrlen);
    - sockfdï¼šæ ‡è¯†ä¸€ä¸ªå¥—æ¥å­—ã€‚
    - serv_addrï¼šç»“æ„ä½“å¥—æ¥å­—sæƒ³è¦è¿æ¥çš„ä¸»æœºåœ°å€å’Œç«¯å£å·ã€‚
    - addrlenï¼šç»“æ„ä½“çš„é•¿åº¦ã€‚

  ```objc
  struct sockaddr_in addr;
  addr.sin_family = AF_INET;
  addr.sin_addr.s_addr = inet_addr("192.168.88.100");
  addr.sin_port = htons(3000);
  int result = connect(clientSocket, (const struct sockaddr *) &addr, sizeof(addr));
  // è¿”å›å€¼ä¸º0åˆ™è¿æ¥æˆåŠŸï¼Œéé›¶åˆ™è¿æ¥å¤±è´¥
  ```

- å‘é€æ•°æ®ç»™æœåŠ¡å™¨

  ```objc
  NSString *sendMsg = @"GET / HTTP/1.1\r\n"
                       "Host: www.baidu.com\r\n"
                       "Connection: close\r\n\r\n"];
  // è‡ªå·±å°è£…å¥½è¯·æ±‚å¤´ï¼ˆéµå®ˆHTTPåè®®ï¼‰ï¼Œæ‰å‘é€ç»™æœåŠ¡å™¨å‘é€
  const char *sendMessage = sendMsg.UTF8String;
  ssize_t sendLen = send(clientSocket, sendMessage, strlen(sendMessage), 0);
  NSLog(@"å‘é€çš„å­—èŠ‚æ•°ï¼š%ld",sendLen);
  ```

- ä»æœåŠ¡å™¨æ¥æ”¶æ•°æ®

  ```objc
  uint8_t buffer[1024];
  ssize_t recvCount = -1;
  NSMutableData *mData = [NSMutableData new];
  do {
      // å¾ªç¯æ¥æ”¶æ•°æ®ï¼Œç›´åˆ°æœåŠ¡å™¨ä¼ å®Œäº†æ‰åœæ­¢
      recvCount = recv(self.clientSocket, buffer, sizeof(buffer), 0);
      if (recvCount) {
          [mData appendBytes:buffer length:recvCount];
      }
  }while(recvCount != 0);
  NSString *res = [[NSString alloc] initWithData:mData encoding:NSUTF8StringEncoding];
  return res;
  ```

- å…³é—­è¿æ¥ `close(clientSocket);`

- è·å¾—å“åº”ä½“çš„å†…å®¹ï¼Œå³å“åº”å¤´å»æ‰

  ```objc
  // æˆªå–å“åº”å¤´ç»“æŸä½ç½®
  NSRange range = [res rangeOfString:@"\r\n\r\n"];
  // åœ¨å“åº”å¤´ç»“æŸä½ç½®åå¼€å§‹è·å¾—html
  NSString *html = [res substringFromIndex:range.location+range.length];
  ```

## JSON è§£æ

NSDictionary *dict = [NSJSONSerialization JSONObjectWithData:data options:0 error:&error];

- å‚æ•°ä¸€ï¼šNSDataç±»å‹çš„äºŒè¿›åˆ¶æ•°æ®
- å‚æ•°äºŒï¼šoptionsï¼š
  - 0 ï¼ˆé€šå¸¸éƒ½ä¼ è¿™ä¸ªï¼‰
    - ä¸åšä»»ä½•å¤„ç†
  - NSJSONReadingMutableContainers = (1UL << 0) 
    - æŠŠå®¹å™¨ï¼ˆæœ€å¤–å±‚ï¼‰è½¬æˆå¯å˜çš„æ•°ç»„æˆ–è€…å¯å˜çš„è¯å…¸
  -  NSJSONReadingMutableLeaves = (1UL << 1)
    - å¦‚æœjsonå†…æ‰€æœ‰ä¸œè¥¿éƒ½å˜æˆå¯å˜çš„
  -  NSJSONReadingFragmentsAllowed = (1UL << 2)
    - å¦‚æœä¸æ˜¯åˆæ³•çš„JSONæ ¼å¼ï¼Œä¹Ÿè§£æï¼ˆé€šå¸¸éƒ½ä¸ç”¨ï¼‰
- å‚æ•°ä¸‰ï¼šNSError ä¸€ä¸ªå¯¹è±¡çš„åœ°å€

```objc
NSError *error;
NSDictionary *dict = [NSJSONSerialization JSONObjectWithData:data options:0 error:&error];
if (error) {
    NSLog(@"JSONparse error: %@",error);
    return;
}
NSLog(@"%@",dict);
```

**è§£å†³è¾“å‡ºæ˜¯Unicodeæºç çš„é—®é¢˜**ï¼šç»™æ•°ç»„æˆ–è€…å­—å…¸å†™ä¸€ä¸ªç±»æ‰©å±•ï¼Œæ”¹å†™å…¶descriptionWithLocaleæ–¹æ³•Xcode8ä»¥å‰

```objc
- (NSString *)descriptionWithLocale:(id)locale{
    NSMutableString *msg = [NSMutableString new];
    [msg appendString:@"\r\n{\r\n"];
    for (id key in self) {
        [msg appendFormat:@"\t%@: %@,\r\n", key, self[key]];
    }
    [msg appendString:@"}"];
    return msg.copy;
}
```

xcode8ä»¥åé‡å†™çš„æ–¹æ³•å°±å˜äº†descriptionWithLocale:indext:level: é»˜è®¤è°ƒç”¨å˜æˆè¿™ä¸ªæ–¹æ³•äº†

```objc
- (NSString *)descriptionWithLocale:(id)locale indent:(NSUInteger)level{
    NSMutableString *msg = [NSMutableString new];
    [msg appendString:@"\r\n{\r\n"];
    for (id key in self) {
        [msg appendFormat:@"\t%@: %@,\r\n", key, self[key]];
    }
    [msg appendString:@"}"];
    return msg.copy;
}
```

ä¸ºäº†å¯ä»¥nslogç±»ä¸­çš„æ–¹æ³•æˆ‘ä»¬å¯ä»¥é‡å†™ç±»çš„ descriptionæ–¹æ³•

```objc
- (NSString *)description
{
    return [NSString stringWithFormat:@"<%@: %p> {videoId: %@, name: %@, length: %@, videoURL: %@, imageURL: %@, desc: %@, teacher: %@, time: %@}", [self class], self, self.videoId, self.name, self.length, self.videoURL, self.imageURL, self.desc, self.teacher, self.time];
}
```

ä¸€ä¸ªåˆ†ç±»æ–‡ä»¶é‡Œé¢å¯ä»¥å†™å¤šä¸ªåˆ†ç±»ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–‡ä»¶æ•°ç»„å’Œå­—å…¸éƒ½é‡å†™è¿™ä¸ªæ–¹æ³•å°±å¥½äº†ã€‚

**æ³¨æ„**ï¼šæˆ‘ä»¬ç»™JSONåšå­—å…¸è½¬æ¨¡å‹çš„æ—¶å€™ä¸€äº›æ•°ç»„ç±»å‹æˆ‘ä»¬éƒ½ç”¨NSNumberæ¥æ”¶ï¼Œå› ä¸ºæœ‰å¯èƒ½æœåŠ¡å™¨è¿”å›çš„æ˜¯nullï¼Œç”¨intã€floatè¿™äº›æ¥æ”¶ä¼šæŠ¥é”™

### JSONåºåˆ—åŒ–

```objc
NSDictionary *dict = @{@"name": @"xiaoming", @"age": @12, @"fun":@"123"};
NSArray *arr = @[@{@"name":@"å¼ ä¸‰"},@{@"name":@"æå››"}];
// åˆ¤æ–­å¯¹è±¡æ˜¯å¦èƒ½åºåˆ—åŒ–ï¼Œèƒ½åºåˆ—åŒ–çš„åªæœ‰æ•°ç»„å’Œå­—å…¸ï¼Œå¦‚æœå­—å…¸æˆ–è€…æ•°ç»„ä¸­å­˜åœ¨è‡ªå®šä¹‰å¯¹è±¡å®æƒ æŠ¥é”™çš„
if (![NSJSONSerialization isValidJSONObject:v1]) {
    NSLog(@"å¯¹è±¡ä¸èƒ½åºåˆ—åŒ–");
    return;
}
// è¿™æ ·ç›´æ¥è½¬åŒ–ä¸ºäºŒè¿›åˆ¶æ•°æ®ï¼Œå°±å¯ä»¥ç›´æ¥request.HTTPBody=data ç›´æ¥ä¼ äº†
NSData *dataDict = [NSJSONSerialization dataWithJSONObject:dict options:0 error:nil];
NSData *dataArr = [NSJSONSerialization dataWithJSONObject:arr options:0 error:nil];
```

### æ¨¡å‹è½¬å­—å…¸

å› ä¸ºJOSNåºåˆ—åŒ–ä¸èƒ½æ˜¯è‡ªå®šä¹‰å¯¹è±¡ï¼Œè€Œæˆ‘ä»¬æƒ³æŠŠè‡ªå®šä¹‰å¯¹è±¡åºåˆ—åŒ–å‘é€ç»™æœåŠ¡å™¨å°±è¦åšæ¨¡å‹è½¬å­—å…¸

```objc
// å‚æ•°ä¸­çš„æ•°ç»„å°±æ˜¯å¯¹è±¡ä¸­çš„å±æ€§åï¼Œç”¨KVCçš„æ–¹æ³•è¿˜å¯ä»¥è·å–åˆ°.mä¸­çš„çœŸç§æœ‰å±æ€§
NSDictionary *dict = [v1 dictionaryWithValuesForKeys:@[@"videoName",@"size",@"_isYellow"]];
```

```objc
// æ¨¡å‹æ•°ç»„ä¸­æ¯ä¸ªæ¨¡å‹è½¬ä¸ºå­—å…¸
NSMutableArray *arrM = [NSMutableArray new];
for (Model* model in self.models) {
    NSDictionary *dict = [Model dictionaryWithValuesForKeys:@[@"prop1",@"prop2",@"prop3"]];
    [arrM addObject:dict];
}
NSData *data = [NSJSONSerialization dataWithJSONObject:arrM options:0 error:nil];
```

## Plist è§£æ

å¼€å‘çš„æ—¶å€™æ— è®ºæ˜¯ç½‘ç»œè¿˜æ˜¯æœ¬åœ°é€šå¸¸éƒ½ä¸ç”¨plistï¼Œé¦–å…ˆæ•°æ®é‡å¤§ï¼Œå†è€…ä¸å¯èƒ½åªåšiOSï¼Œpliståˆ«çš„è¯­è¨€æ˜¯è§£æä¸äº†çš„

```objc
NSError *error;
NSArray *arr = [NSPropertyListSerialization propertyListWithData:data options:0 format:0 error:&error];
if (error) {
    NSLog(@"plistparse error: %@",error);
    return;
}
NSLog(@"%@",arr);
```

## XML

- ä»€ä¹ˆæ˜¯XML

  - Extentsible Markup Languageï¼ˆå¯æ‰©å±•æ ‡è®°è¯­è¨€ï¼‰
  - HTML ï¼ˆè¶…æ–‡æœ¬æ ‡è®°è¯­è¨€ï¼‰XMLä¸HTMLååˆ†ç±»ä¼¼
  - éå¸¸ç±»ä¼¼äºHTMLï¼ŒHTMLçš„ä½œç”¨æ˜¯æ˜¾ç¤ºæ•°æ®ï¼ŒXMLçš„ç›®çš„æ˜¯å­˜å‚¨å’Œä¼ è¾“æ•°æ®
  - XMLæ˜¯å„ç§åº”ç”¨ä¹‹é—´ä¼ è¾“æ•°æ®æ˜¯ä»¥å‰å¸¸ç”¨çš„æ ¼å¼ï¼Œç°åœ¨å‡ ä¹ä¸ç”¨ï¼Œéƒ½ç”¨JSON
  - W3Cçš„æ¨èæ ‡å‡†
- XMLç”±æ ‡è®°ç»„æˆ
- <tag> è¿™å°±æ˜¯æ ‡è®°ï¼Œxmlçš„æ ‡è®°æ˜¯å¯æ‰©å±•çš„ï¼Œæ²¡æœ‰é¢„å®šä¹‰
- æœ‰ä¸”åªæœ‰ä¸€ä¸ªæ ¹èŠ‚ç‚¹
```objc
<Human>
    <Person color="yellow" weight="130" height="150">
        <name>wg</name>
        <age>108</age>
    </Person>
    <Student name="y" />
</Human>
```

- XMLæ ¼å¼çš„è§£ææ–¹å¼

  - SAX ï¼šiOSä¸Šè§£æï¼Œé€Ÿåº¦å¿«ï¼Œå†…å­˜å ç”¨å°ï¼Œåªè¯»
  - DOM ï¼š macä¸Šçš„è§£ææ–¹å¼ï¼ŒiOSæ— æ³•ç›´æ¥ä½¿ç”¨ï¼Œè§£æè¿‡ç¨‹ä¸­å†…å­˜å ç”¨å¤§ï¼Œè¯»å†™

- SAXçš„è§£ææ­¥éª¤ï¼š

  a. åŠ è½½xmlæ•°æ®

  b. æ‰¾å¼€å§‹èŠ‚ç‚¹(åŒ…æ‹¬èŠ‚ç‚¹çš„å±æ€§)

  c. æ‰¾èŠ‚ç‚¹ä¹‹é—´çš„å†…å®¹

  d. æ‰¾ç»“æŸèŠ‚ç‚¹

  e. ç›´åˆ°æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼Œè§£æç»“æŸ
  
- ç½‘ç»œæ¨¡å‹ä¸­ç”¨copyä¿®é¥°ç±»ä¸­çš„å±æ€§ï¼ŒåŒ…æ‹¬NSNumber

- å¦åˆ™çš„è¯KVCèµ‹å€¼çš„valueæ˜¯NSMutableStringçš„æ—¶å€™ä¼šæœ‰é—®é¢˜ï¼Œå€¼æ˜¯å¯å˜å­—ç¬¦ä¸²ä¸­çš„æœ€åä¸€ä¸ªå€¼

```objc
NSXMLParser *parser = [[NSXMLParser alloc] initWithData:data];
// è®¾ç½®ä»£ç†, åœ¨å“ªä¸ªçº¿ç¨‹è®¾ç½®ä»£ç†ï¼Œä»£ç†æ–¹æ³•å°±æ‰§è¡Œåœ¨é‚£ä¸ªçº¿ç¨‹
parser.delegate = self;
// parseæ–¹æ³•ä»£è¡¨å¼€å§‹æ‰§è¡Œä»£ç†çš„æ–¹æ³•
[parser parse];

// å®ç°ä»£ç†æ–¹æ³•
- (void)parserDidStartDocument:(NSXMLParser *)parser{
    // å¼€å§‹è§£ææ–‡æ¡£
    
}
- (void)parser:(NSXMLParser *)parser didStartElement:(NSString *)elementName namespaceURI:(NSString *)namespaceURI qualifiedName:(NSString *)qName attributes:(NSDictionary<NSString *,NSString *> *)attributeDict{
    // æ‰¾å¼€å§‹èŠ‚ç‚¹(åŒ…æ‹¬èŠ‚ç‚¹çš„å±æ€§)
    // elementName èŠ‚ç‚¹åç§°
    // attributeDict èŠ‚ç‚¹æ ‡ç­¾
    if ([elementName isEqualToString:@"video"]) {
        self.currentVideo = [[MResponse alloc] init];
        self.currentVideo.videoId = @([attributeDict[@"videoId"] intValue]);
        [self.videos addObject:self.currentVideo];
    }
}

- (void)parser:(NSXMLParser *)parser foundCharacters:(NSString *)string{
    // æ‰¾èŠ‚ç‚¹ä¹‹é—´çš„å†…å®¹
    [self.mStr appendString:string];
}

- (void)parser:(NSXMLParser *)parser didEndElement:(NSString *)elementName namespaceURI:(NSString *)namespaceURI qualifiedName:(NSString *)qName{
    // æ‰¾ç»“æŸèŠ‚ç‚¹
    if (![elementName isEqualToString:@"video"] && ![elementName isEqualToString:@"videos"]) {
        [self.currentVideo setValue:self.mStr forKey:elementName];
    }
    [self.mStr setString:@""];
}

-(void)parserDidEndDocument:(NSXMLParser *)parser{
    // ç»“æŸè§£ææ–‡æ¡£
    NSLog(@"%@",self.videos);
}

- (void)parser:(NSXMLParser *)parser parseErrorOccurred:(NSError *)parseError{
    // è§£æå‡ºé”™
}
```

ååˆ†å¤æ‚ï¼Œå› æ­¤ä¸å¸¸ç”¨

- DOMæ–¹å¼çš„è§£æ Document Object Model

  - DOM--æ–‡æ¡£å¯¹è±¡æ¨¡å‹(æ–‡æ¡£ğŸŒ²æ¨¡å‹)
- ä¸€æ¬¡æ€§æŠŠxmlå…¨éƒ¨åŠ è½½åˆ°å†…å­˜ï¼Œå†…å­˜æ¶ˆè€—å¤§
  - ä¹‹å‰çš„SAXæ–¹å¼åªèƒ½è¯»å–XMLï¼ŒDOMå¯ä»¥ä¿®æ”¹ï¼Œæ·»åŠ åˆ é™¤ä¿®æ”¹èŠ‚ç‚¹
- iOSé»˜è®¤ä¸æ”¯æŒDOMè§£æï¼ˆä¸æ”¯æŒNSXMLè¿™ä¸ªç±»ï¼‰
  
  - åœ¨iOSè§£æDOMçš„è¯éœ€è¦ç¬¬ä¸‰æ–¹æ¡†æ¶
    - GData/KissXML(XMPPä¸­ä½¿ç”¨æ­¤æ¡†æ¶)
- é€‚åˆè¯»å†™æ¯”è¾ƒå°çš„XMLæ–‡ä»¶
  - é€šå¸¸ç”¨GDataXMLNodeè¿™ä¸ªæ¡†æ¶åœ¨iOSä¸­ä½¿ç”¨
    - å¼•å…¥å®Œè¿™ä¸ªæ¡†æ¶åæ ¹æ®å¤´æ–‡ä»¶æœ€ä¸Šæ–¹æ³¨é‡Šçš„æç¤º
  - åœ¨é¡¹ç›®build settingsé‡Œæœç´¢ Header Search Paths è®¾ç½®ä¸º /usr/include/libxml2
    - åœ¨é¡¹ç›®build settingsé‡Œæœç´¢ Other Linker Flags è®¾ç½®ä¸º -lxml2

```objc
NSError *error;
GDataXMLDocument *document = [[GDataXMLDocument alloc] initWithData:data error:&error];
GDataXMLElement *rootElement = document.rootElement;
NSMutableArray *arrM = [NSMutableArray new];
for (GDataXMLElement *ele in rootElement.children) {
    MResponse *v = [MResponse new];
    [arrM addObject:v];
    // ç»™å¯¹è±¡çš„å±æ€§èµ‹å€¼
    // éå†å­æ ‡ç­¾
    for (GDataXMLElement *subEle in ele.children) {
        //subEle.name æ ‡ç­¾çš„åå­— subEle.stringValueå°±æ˜¯æ ‡ç­¾çš„å†…å®¹
        [v setValue:subEle.stringValue forKey:subEle.name];
    }
    // éå†å±æ€§
    for (GDataXMLNode *attr in ele.attributes) {
        [v setValue:attr.stringValue forKey:attr.name];
    }
}
if (error) {
    NSLog(@"xmlparse error: %@",error);
    return;
}
NSLog(@"%@", arrM);
```




## è·å–ç½‘ç»œæ•°æ®

- æ³•ä¸€ï¼šNSDataï¼Œè¿™ç§è®¾ç½®æ–¹æ³•ä¸èƒ½è®¾ç½®è¯·æ±‚åšä¸€äº›å“åº”çš„è®¾ç½®ï¼Œç¼“å­˜ç­–ç•¥ã€è¶…æ—¶æ—¶é•¿ã€å“åº”å¤´ç­‰ã€‚

```objc
NSURL *url = [NSURL URLWithString:@"http://127.0.0.1/aaa/demo.json"];
NSData *data = [NSData dataWithContentsOfURL:url];
NSString *str = [[NSString alloc] initWithData:data encoding:NSUTF8StringEncoding];
NSLog(@"%@",str);
```

- æ³•äºŒï¼šNSURLConnection sendAsynchronousRequestï¼Œè¿™ä¸ªAPI iOS9å°±è¿‡æœŸäº†

```objc
NSURL *url = [NSURL URLWithString:@"http://192.168.88.100/aaa/demo.json"];
//    NSMutableURLRequest *request = [NSMutableURLRequest requestWithURL:url];
// **è®¾ç½®ç¼“å­˜ç­–ç•¥ï¼Œå’Œè¿æ¥å»¶æ—¶ï¼ˆè¶…æ—¶åä¸ç®¡æœåŠ¡å™¨æ–­ä¸æ–­å¼€è¿æ¥ï¼Œå®¢æˆ·ç«¯éƒ½æ–­å¼€**
NSMutableURLRequest *request = [NSMutableURLRequest requestWithURL:url cachePolicy:NSURLRequestUseProtocolCachePolicy timeoutInterval:15];
// æ·»åŠ å“åº”å¤´
[request setValue:@"Mozilla/5.0 (iPhone; CPU iPhone OS 13_2_3 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.0.3 Mobile/15E148 Safari/604.1" forHTTPHeaderField:@"User-Agent"];
[NSURLConnection sendAsynchronousRequest:request queue:self.queue completionHandler:^(NSURLResponse * _Nullable response, NSData * _Nullable data, NSError * _Nullable connectionError) {
    if (connectionError) {
        NSLog(@"connect error");
        return;
    }
    NSHTTPURLResponse *httpResponse = (NSHTTPURLResponse*)response;
    if (httpResponse.statusCode != 200 && httpResponse.statusCode != 304) {
        NSLog(@"server error");
        return;
    }
    NSString *str = [[NSString alloc] initWithData:data encoding:NSUTF8StringEncoding];
    NSLog(@"%@", str);
}];
```

- æ³•ä¸‰ NSURLSession

```objc
- (void)dataTask1 {
    NSURL *url = [NSURL URLWithString:@"http://192.168.1.6/aaa/demo.json"];
    // sessionä»»åŠ¡éƒ½æ˜¯é»˜è®¤æŒ‚èµ·çš„ï¼ˆæ²¡æœ‰è°ƒç”¨ï¼‰
    [[[NSURLSession sharedSession] dataTaskWithURL:url completionHandler:^(NSData * _Nullable data, NSURLResponse * _Nullable response, NSError * _Nullable error) {
        if (error) {
            NSLog(@"connection error");
            return;
        }
        NSHTTPURLResponse *httpRes = (NSHTTPURLResponse*)response;
        if (httpRes.statusCode != 200 && httpRes.statusCode != 304) {
            NSLog(@"server error");
            return;
        }
        NSDictionary *dict = [NSJSONSerialization JSONObjectWithData:data options:0 error:NULL];
        NSLog(@"%@",dict);
        // è®°å¾—æœ€åå†è°ƒç”¨resumeæ–¹æ³•å¼€å¯ä½¿ç”¨task
    }] resume];
}
```

## HTTP è¯·æ±‚

- åœ¨HTTP/1.1åè®®ä¸­ï¼Œå®šä¹‰äº†8ç§å‘é€httpè¯·æ±‚çš„æ–¹æ³•

- - GETã€POSTã€HEADã€PUTã€DELETEã€OPTIONSã€TRACEã€CONNECTã€PATCH

- æœ€å¸¸ç”¨çš„æ˜¯GETã€POST

**æŠ¥æ–‡**
![](./15.png)

![](./16.png)

**æ³¨æ„**ï¼šåœ¨urlä¸­å¦‚æœå‡ºç°æ±‰å­—è¦è¿›è¡ŒURLè½¬ä¹‰ï¼Œå³è½¬ä¸ºç™¾åˆ†å·åŠ åå…­è¿›åˆ¶çš„æ ¼å¼ã€‚

### GETè¯·æ±‚

å…¶å®å°±æ˜¯å¯¹urlåœ°å€è¿›è¡Œæ‹¼æ¥ï¼ŒæŠŠæŸ¥è¯¢å­—ç¬¦ä¸²æ‹¼æ¥åœ¨urlä¸Š(url?åé¢çš„é”®å€¼å¯¹ç§°ä¸ºæŸ¥è¯¢å­—ç¬¦ä¸²)

```objc
NSString *username = @"å¼ ä¸‰";
NSString *password = @"123";
NSString *strUrl = [NSString stringWithFormat:@"http://192.168.88.100/login/login.php?username=%@&password=%@",username,password];
// æŸ¥è¯¢å­—ç¬¦ä¸²ï¼ˆä¹Ÿå°±æ˜¯ï¼Ÿé‚£éƒ¨åˆ†é”®å€¼å¯¹ï¼‰éƒ¨åˆ†è½¬ä¹‰æ±‰å­—
strUrl = [strUrl stringByAddingPercentEncodingWithAllowedCharacters:[NSCharacterSet URLQueryAllowedCharacterSet]];
NSURL *url = [NSURL URLWithString:strUrl];
```

### POSTè¯·æ±‚

postè¯·æ±‚è¦ç»™è¯·æ±‚åŠ è¯·æ±‚ä½“

```objc
NSString *username = @"å¼ ä¸‰";
NSString *password = @"zhang";
NSString *strUrl = @"http://192.168.88.100/login/login.php";
NSURL *url = [NSURL URLWithString:strUrl];
NSMutableURLRequest *request = [NSMutableURLRequest requestWithURL:url cachePolicy:0 timeoutInterval:15];
request.HTTPMethod = @"post";
NSString *body = [NSString stringWithFormat:@"username=%@&password=%@",username,password];
// è¦æŠŠæŸ¥è¯¢å­—ç¬¦ä¸²è½¬åŒ–ä¸ºäºŒè¿›åˆ¶æ•°æ®ï¼ˆNSDataï¼‰
request.HTTPBody = [body dataUsingEncoding:NSUTF8StringEncoding];
// ç„¶åæ ¹æ®requestæ­£å¸¸ç»™æœåŠ¡å™¨å‘æ•°æ®å°±å¥½äº†
```

## base64

- base64ç¼–ç ---æœ¬è´¨æ˜¯ç¼–ç ä¸æ˜¯åŠ å¯†

  - å¯ä»¥å°†ä»»æ„çš„äºŒè¿›åˆ¶æ•°æ®ç¼–ç æˆå­—ç¬¦ä¸²ï¼Œåœ¨ç½‘ç»œä¸Šä¼ è¾“

  - åœ¨ç»ˆç«¯ä¸­æ¼”ç¤º

    - base64ç¼–ç 

      - base64 xx.png -o abc.txt  ç¼–ç æ–‡ä»¶
      - echo -n "Man" | base64      ç¼–ç å­—ç¬¦ä¸²

    - base64è§£ç 

      - base64 abc.txt -o xx.png -D  è§£ç æ–‡ä»¶
      - echo -n "TWFu" | base64 -D      è§£ç å­—ç¬¦ä¸²

- base64ç¼–ç çš„åŸç†

  - ç¼–ç åçš„æ•°æ®ç”± a-z  A-Z 0-9 + / = è¡¨ç¤º 
  - æŠŠä¸€ä¸ªå­—ç¬¦è½¬æ¢æˆäºŒè¿›åˆ¶å–å‡ºå‰6ä½æŸ¥è¡¨ 
  - ä¸å¤Ÿ6ä½çš„æ—¶å€™è¡¥0ï¼Œå¦‚æœæ˜¯8ä½ï¼Œåˆ™è¡¥4ä¸ª0 ï¼Œç¼–ç åè¿æ¥ä¸¤ä¸ª==
  - å¦‚æœæœ€åæ˜¯4ä½ï¼Œè¡¥2ä¸ª0ï¼Œç¼–ç åè¿æ¥ä¸€ä¸ª=
  - ç¼–ç ä¹‹åæ–‡ä»¶ä¼šå˜å¤§ï¼Œæ˜¯æºæ–‡ä»¶çš„4/3 â€”12/8  6/4 â€” 3/2

### base64ç¼–ç 

```objc
- (NSString*)base64Encode:(NSString*)str {
    NSData *data = [str dataUsingEncoding:NSUTF8StringEncoding];
    return [data base64EncodedStringWithOptions:0];
}
```

### base64è§£ç 

```objc
- (NSString*)base64Decode:(NSString*)str {
    NSData *data = [[NSData alloc] initWithBase64EncodedString:str options:0];
    return [[NSString alloc] initWithData:data encoding:NSUTF8StringEncoding];
}
```

## åŠ å¯†å’Œè§£å¯†

- å¯¹ç§°ç®—æ³•

- - åŠ å¯†è§£å¯†éƒ½ä½¿ç”¨ç›¸åŒçš„ç§˜é’¥
  - é€Ÿåº¦å¿«ï¼Œé€‚åˆå¯¹å¤§æ•°æ®åŠ å¯†
  - DESï¼Œ3DESï¼ŒAES

- éå¯¹ç§°ç®—æ³•

- - ç®—æ³•å…¬å¼€ï¼Œå¯é€†çš„åŠ å¯†ç®—æ³•
  - ç”¨å…¬é’¥åŠ å¯†ï¼Œç”¨ç§é’¥è§£å¯†
  - ç”¨ç§é’¥åŠ å¯†ï¼Œç”¨å…¬é’¥è§£å¯†ï¼ˆå‡ ä¹ä¸ç”¨ï¼‰
  - é€Ÿåº¦æ…¢ï¼Œé€‚åˆå¯¹å°æ•°æ®åŠ å¯†
  - RSA

- æ™®éçš„åŠ å¯†

- - ç§˜é’¥çš„å®‰å…¨è¦æ±‚å¾ˆé«˜çš„è¯ï¼Œå¯ä»¥å…ˆç”¨RSAåŠ å¯†AESçš„ç§˜é’¥ï¼ˆå³ç”¨å¯¹ç§°ç®—æ³•åŠ å¯†ï¼Œä½†æ˜¯é‚£ä¸ªåŠ å¯†çš„ç§˜é’¥å†ç”¨ä¸€å±‚éå¯¹ç§°ç®—æ³•åŠ å¯†çš„åˆ°ç§˜é’¥çš„ç§˜é’¥ï¼Œå¥—å¨ƒï¼‰

- æ•£åˆ—ç®—æ³•

  - å°±æ˜¯åœ¨åŸæ•°æ®ä¸­æå–ä¸€éƒ¨åˆ†æ¥åŠ å¯†ï¼Œå…¶ä½™éƒ¨åˆ†ç›´æ¥èˆå¼ƒ

- - ä¸å¯é€†åŠ å¯†ï¼šMD5ã€SHA1ã€SHA256ã€SHA512

### MD5

- MD5ç®—æ³•

- - å¯¹ä»»æ„çš„æ•°æ®æº è®¡ç®—ï¼Œç”Ÿæˆå›ºå®šé•¿åº¦çš„å­—ç¬¦ä¸²ã€‚32ä¸ªå­—ç¬¦
  - ä¸€èˆ¬ç”¨æ¥åŠ å¯†å¯†ç 
  - è®¡ç®—æ–‡ä»¶çš„md5å€¼ï¼Œç”¨æˆ·å¯ä»¥éªŒè¯ä»ç½‘ç»œä¸Šä¸‹è½½çš„æ–‡ä»¶æ˜¯å¦åœ¨ä¸‹è½½çš„è¿‡ç¨‹ä¸­è¢«ä¿®æ”¹äº†

- ç»ˆç«¯æµ‹è¯•md5

- - md5 -s "admin"
  - ç»“æœï¼š 21232f297a57a5a743894a0e4a801fc3

- æ¨¡æ‹Ÿç”¨æˆ·ç™»å½•ä¸­æ”¹ç”¨md5åŠ å¯†

**MD5æš´åŠ›ç ´è§£**

- ç ´è§£md5ï¼Œæš´åŠ›ç ´è§£(md5æ˜¯ä¸å¯é€†çš„)

- - ç™¾åº¦--åœ¨çº¿ç ´è§£md5
  - å…¶å®å°±æ˜¯ä¸€ä¸ªä¸€ä¸ªå­—ç¬¦ä¸²å»è¯•ï¼Œç„¶åä¸€ä¸€å¯¹åº”

- é˜²æ­¢è¢«æš´åŠ›ç ´è§£

- - åŠ ç›

  - - åŸå¯†ç +ä¸€ä¸ªå¤æ‚çš„å­—ç¬¦ä¸²ï¼Œé˜²æ­¢ç”¨æˆ·è¾“å…¥çš„å¯†ç è¿‡äºç®€å•

  - HMAC

  - - åŸå¯†ç +ä¸€ä¸ªå­—ç¬¦ä¸² è¿›è¡Œæ··åˆå† md5è®¡ç®—  æŠŠè®¡ç®—çš„ç»“æœ+åŸå¯†ç  å†è¿›è¡Œmd5è®¡ç®—

  - md5+æ—¶é—´ï¼Œæ¯æ¬¡ç”Ÿæˆçš„md5å€¼ä¸ä¸€æ ·ï¼Œè¿™æ ·å³ä½¿æ˜¯è¢«æ‹¦æˆªåˆ°ä¿¡æ¯ï¼Œè¶…æ—¶äº†åŸä¹Ÿå°±æ²¡ç”¨äº†

  - - ä¸€ä¸ªå­—ç¬¦ä¸²key  md5è®¡ç®—
    - æŠŠåŸå¯†ç å’Œä¹‹å‰ç”Ÿæˆçš„md5å€¼å†è¿›è¡ŒhmacåŠ å¯†
    - ä»æœåŠ¡å™¨è·å–å½“å‰æ—¶é—´ åˆ°åˆ†é’Ÿ çš„å­—ç¬¦ä¸²
    - ç¬¬äºŒæ­¥äº§ç”Ÿçš„hmacå€¼+æ—¶é—´   å’Œç¬¬ä¸€æ­¥äº§ç”Ÿçš„md5å€¼è¿›è¡ŒhmacåŠ å¯†

```objc
// æ™®é€šçš„md5åŠ å¯†
#import <CommonCrypto/CommonCrypto.h>
- (NSString *)md5String:(NSString*)string {
    const char *str = string.UTF8String;
    uint8_t buffer[CC_MD5_DIGEST_LENGTH];
    
    CC_MD5(str, (CC_LONG)strlen(str), buffer);
    // ä¸ºäº†è¿”å›ä¸€ä¸ªOCå­—ç¬¦ä¸²ï¼Œå†å†™ä¸€ä¸ªæ–¹æ³•
    return [self stringFromBytes:buffer length:CC_MD5_DIGEST_LENGTH];
}
- (NSString *)stringFromBytes:(uint8_t *)bytes length:(int)length {
    NSMutableString *strM = [NSMutableString string];
    
    for (int i = 0; i < length; i++) {
        [strM appendFormat:@"%02x", bytes[i]];
    }
    
    return [strM copy];
}
```

### é’¥åŒ™ä¸²

- é€šè¿‡ç³»ç»Ÿæä¾›çš„é’¥åŒ™ä¸²åŠŸèƒ½å¯ä»¥åœ¨æœ¬åœ°ä¿å­˜å¯†ç ï¼Œç³»ç»Ÿä½¿ç”¨AESçš„æ–¹å¼å¯¹å¯†ç åŠ å¯†ï¼ˆå¯¹ç§°åŠ å¯†ï¼‰

  - æŸ¥çœ‹Safariä¸­ä¿å­˜çš„å¯†ç 

- ä½¿ç”¨ç¬¬ä¸‰æ–¹æ¡†æ¶SSKeychainæŠŠå¯†ç ä¿å­˜åˆ°é’¥åŒ™ä¸²å’Œè·å–é’¥åŒ™ä¸²ä¸­çš„å¯†ç 

  - è·å–é’¥åŒ™ä¸²ä¸­çš„æ‰€æœ‰ç”¨æˆ·

    - [SSKeychain allAccounts]

  - æŠŠå¯†ç ä¿å­˜åˆ°é’¥åŒ™ä¸²ä¸­ serviceå¯ä»¥ç”¨bundleIDï¼Œ

    - kPWDCHAINKEY è¿™ä¸ªå®æ˜¯è‡ªå·±å†™çš„ [NSBundle mainBundle].bundleIdentifier

    - [SSKeychain setPassword:self.pwdView.text forService:kPWDCHAINKEY account:self.nameView.text];

  - ä»é’¥åŒ™ä¸²ä¸­è·å–å¯†ç 

    - self.pwdView.text = [SSKeychain passwordForService:kPWDCHAINKEY account:self.nameView.text];

## æ–‡ä»¶ä¸Šä¼ 

- è¯·æ±‚ä½“ä¸­å„é¡¹çš„å«ä¹‰

```objc
// è¯·æ±‚å¤´
Content-Type: multipart/form-data; boundary=bond
// è¯·æ±‚ä½“
--bond    
Content-Disposition: form-data; name="userfile"; filename="03.JPG" 
Content-Type: image/jpeg 

äºŒè¿›åˆ¶æ•°æ®
--bond--
```

- è¯·æ±‚ä½“ä¸­çš„å†…å®¹
  - åˆ†éš”ç¬¦  ------WebKitFormBoundaryuWw18YzUxr2ygEJi  
  - name è¡¨å•çš„nameå±æ€§å€¼
  - filename ä¼ é€’ç»™æœåŠ¡å™¨çš„æ–‡ä»¶å
  - Content-Type  å‘Šè¯‰æœåŠ¡å™¨ä¼ é€’çš„æ–‡ä»¶ç±»å‹
  - text/plain  image/jpeg  image/jpg  image/png  application/octet-stream ç­‰
    - application/octet-streamè¡¨ç¤ºä»»æ„çš„æ–‡ä»¶ç±»å‹ï¼Œ
  - äºŒè¿›åˆ¶æ•°æ® è¦ä¸Šä¼ æ–‡ä»¶çš„NSData
  - ------WebKitFormBoundaryuWw18YzUxr2ygEJi--

```objc
// ä¸“é—¨å‡­å€Ÿè¯·æ±‚ä½“çš„æ–¹æ³•
#define kBoundary @"test"
- (NSData*)makeRequestBodyWithfileFieldName:(NSString*)fileField filePath:(NSString*)path{
    NSMutableData *dataM = [NSMutableData new];
    NSMutableString *strM1 = [NSMutableString new];
    [strM1 appendFormat:@"--%@\r\n",kBOUNDARY];
    [strM1 appendFormat:@"Content-Disposition: form-data; name=\"%@\"; filename=\"%@\"\r\n", fileField, [path lastPathComponent]];
    [strM1 appendString:@"Content-Type: application/octet-stream\r\n\r\n"];
    [dataM appendData:[strM1 dataUsingEncoding:NSUTF8StringEncoding]];
    
    [dataM appendData:[NSData dataWithContentsOfFile:path]];
    
    NSString *end = [NSString stringWithFormat:@"\r\n--%@--",kBOUNDARY];
    [dataM appendData:[end dataUsingEncoding:NSUTF8StringEncoding]];
    return dataM.copy; // è¿™ä¸ªäºŒè¿›åˆ¶ç›´æ¥ç»™request.HTTPBodyå°±å¥½äº†
}
```

**ä¸Šä¼ å¤šä¸ªæ–‡ä»¶å’Œä¸€ä¸ªæ–‡ä»¶è¯·æ±‚ä½“å·®ä¸å¤šç›´æ¥æ‹¼æ¥å­—ç¬¦ä¸²å°±å¥½äº†**

```objc
// è¯·æ±‚å¤´æ˜¯ä¸€æ ·çš„
// è¯·æ±‚ä½“
--boundary
Content-Disposition: form-data; name="userfile[]"; filename="icon-08.png"
Content-Type: image/png

// äºŒè¿›åˆ¶æ•°æ®
--boundary
Content-Disposition: form-data; name="userfile[]"; filename="timg.jpeg"
Content-Type: image/jpeg

// äºŒè¿›åˆ¶æ•°æ®
--boundary
Content-Disposition: form-data; name="username"   // è¿™æ˜¯è·Ÿç€è¡¨å•ä¼ è¿‡æ¥çš„å…¶ä»–ä¿¡æ¯


--boundary--
```

**RESTful**

- ä»€ä¹ˆæ˜¯RESTful

  - ä½¿ç”¨ä¸åŒçš„HTTPè®¿é—®æ–¹æ³•ï¼Œè¯·æ±‚ä¸€ä¸ªURLï¼Œè¡¨è¾¾ä¸åŒçš„è¯­ä¹‰
  - ä¸»è¦ç”±æœåŠ¡å™¨ç«¯å¼€å‘ï¼Œæˆ‘ä»¬ä½¿ç”¨
  - RESTfulé£æ ¼è®©urlçš„å¯è¯»æ€§æ›´å¥½

- ç¤ºä¾‹

  - http://www.ooxx.com/video/cls

    - GET    è·å–æœåŠ¡å™¨ä¸Š clsçš„æ‰€æœ‰è§†é¢‘

    - POST   æ–°å¢æœåŠ¡å™¨ä¸Š clsçš„è§†é¢‘

    - PUT    ä¿®æ”¹æœåŠ¡å™¨ä¸Š clsçš„è§†é¢‘

    - DELETE åˆ é™¤æœåŠ¡å™¨ä¸Š clsçš„è§†é¢‘

      - http://www.ooxx.com/video/cls/c
      - http://www.ooxx.com/video/cls

## æ–‡ä»¶ä¸‹è½½

åœ¨åšæ–‡ä»¶ä¸‹è½½å…ˆï¼Œåº”è¯¥å…ˆå‘ä¸€ä¸ªHEADè¯·æ±‚ï¼Œæ¥æŸ¥çœ‹æ–‡ä»¶ä¿¡æ¯ï¼Œç„¶ååœ¨åšä¸‹è½½

- HEADè¯·æ±‚

  - ä¸è·å–å“åº”ä½“ï¼Œåªè·å–å“åº”å¤´
  - ä¸€èˆ¬åœ¨ä¸‹è½½ä¹‹å‰å…ˆè·å–æ–‡ä»¶çš„å¤§å°

- NSURLResponse çš„å±æ€§

  - MIMEType

    - è¿”å›çš„æ–‡ä»¶çš„ç±»å‹ Content-Type

  - expectedContentLength

    - æ–‡ä»¶çš„é¢„æœŸå¤§å°ï¼ˆå®é™…å¤§å°ï¼‰

  - suggestedFilename

    - å»ºè®®ä¿å­˜çš„æ–‡ä»¶çš„åå­—

- ä»£ç ç¤ºä¾‹ï¼šå¼‚æ­¥è¯·æ±‚

  - è¾“å‡ºçš„dataæ˜¯ç©ºçš„

ä¸‹è½½å…¶å®å°±æ˜¯ä¸€ä¸ªgetè¯·æ±‚ï¼Œä½†æ˜¯å¦‚æœä¸‹è½½æ–‡ä»¶è¿‡å¤§ï¼Œä¼šå‡ºç°å†…å­˜æš´æ¶¨çš„é—®é¢˜ï¼Œå› ä¸ºä¸‹è½½å®Œæˆåä¸€æ¬¡æ€§æŠŠä¸€ä¸ªå¤§æ–‡ä»¶å†™å…¥ä¸€ä¸ªæ–‡ä»¶ä¸­æ˜¯ååˆ†è€—å†…å­˜çš„ï¼Œå› æ­¤ä¸‹è½½è¦è§£å†³å†…å­˜æš´æ¶¨çš„é—®é¢˜ã€‚æˆ‘ä»¬å¯ä»¥ç”¨ä»£ç†æ–¹æ³•æ¥ä¸‹ï¼Œä¸ç”¨ç®€å•ç²—æš´çš„ç›´æ¥ç»™æœåŠ¡å™¨å‘é€getè¯·æ±‚

- ä½¿ç”¨NSURLConnectionçš„ä»£ç†æ–¹æ³•ä¸‹è½½ï¼Œå¯ä»¥ä¸€ç‚¹ä¸€ç‚¹ä¸‹è½½æ–‡ä»¶ï¼Œè§£å†³å†…å­˜ç¬é—´æš´æ¶¨çš„é—®é¢˜
- ä»£ç†NSURLConnectionDataDelegate

- NSURLConnectionDataDelegateä¸­çš„æ–¹æ³•

  - å¯ä»¥è·å–ä¸‹è½½è¿›åº¦
  - å†…å­˜ä¸æš´æ¶¨
  - ä¿å­˜æ–‡ä»¶è¿˜æ²¡æœ‰å®ç°

```objc
@proterty (nonatomic,strong) NSOutputStream *stream;
//æ¥æ”¶åˆ°å“åº”å¤´
- (void)connection:(NSURLConnection *)connection didReceiveResponse:(NSURLResponse *)response{
  //é€šè¿‡å“åº”å¤´è·å–æ–‡ä»¶çš„å¤§å°
    NSLog(@"%lld",response.expectedContentLength);
    self.expectedContentLength = response.expectedContentLength;
    // ç”¨æ•°æ®æµçš„æ–¹å¼ä¸‹è½½
    self.stream = [NSOutputStream outputStreamToFileAtPath:@"/Users/duzuhua/Desktop/1.zip" append:YES];
    [self.stream open];
}
//æŒç»­æ¥æ”¶æ•°æ®
- (void)connection:(NSURLConnection *)connection didReceiveData:(NSData *)data{
    self.currentFileSize += data.length;
    NSLog(@"%f",self.currentFileSize*1.0f/self.expectedContentLength);
    // ç”¨fileHandleçš„æ–¹æ³•ä¿å­˜æ–‡ä»¶
    //[self  saveMethod1:data];
    
    // ç”¨æµçš„æ–¹å¼ä¿å­˜æ–‡ä»¶
    [self.stream write:data.bytes maxLength:data.length];
}
- (void)saveMethod1:(NSData*)data{
Â  Â  //NSFileManager è´Ÿè´£æ–‡ä»¶çš„ åˆ é™¤ã€å¤åˆ¶ã€æ˜¯å¦å­˜åœ¨ç­‰æ“ä½œ
Â  Â  //NSFileHandle è´Ÿè´£å¯¹æ–‡ä»¶çš„å¤„ç†
Â  Â  NSString *path = @"/Users/xxxxx/Desktop/4444.mp4";
Â  Â  //åˆ›å»ºæ–‡ä»¶å¥æŸ„
Â  Â  NSFileHandle *file = [NSFileHandle fileHandleForWritingAtPath:path];
Â  Â  //å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨file == nil
Â  Â  if (file == nil) {
Â  Â  Â  Â  //ç›´æ¥æŠŠdataå†™å…¥æ–‡ä»¶
Â  Â  Â  Â  [data writeToFile:path atomically:YES];
Â  Â  }else{
Â  Â  Â  Â  //æŠŠæ–‡ä»¶æŒ‡é’ˆç§»åŠ¨åˆ°æ–‡ä»¶æœ«å°¾
Â  Â  Â  Â  [file seekToEndOfFile];
Â  Â  Â  Â  //æŠŠæ–‡ä»¶æŒ‡é’ˆç§»åŠ¨åˆ°æŒ‡å®šä½ç½®
//Â  Â  Â  Â  [file seekToFileOffset:<#(unsigned long long)#>]
Â  Â  Â  Â  //å†™å…¥æ–‡ä»¶
Â  Â  Â  Â  [file writeData:data];
Â  Â  Â  Â  //å…³é—­æ–‡ä»¶å¥æŸ„
Â  Â  Â  Â  [file closeFile];
Â  Â  }
}

//ä¸‹è½½å®Œæˆ
- (void)connectionDidFinishLoading:(NSURLConnection *)connection{
    NSLog(@"over");
    [self.stream close];
}

//ä¸‹è½½å‡ºé”™
- (void)connection:(NSURLConnection *)connection didFailWithError:(NSError *)error{
    NSLog(@"é”™è¯¯");
}
```

### NSOutputStream ä¿å­˜æ–‡ä»¶

- NSStream æµ  æŠ½è±¡ç±»

\- (void)open;

\- (void)close;

- NSOutputStream è¾“å‡ºæµ 

  - åœ¨å†…å­˜å’Œç¡¬ç›˜ä¹‹é—´åˆ›å»ºä¸€ä¸ªç®¡é“ï¼Œè¿é€ä¸€äº›å­—èŠ‚
  - æŠŠå­—èŠ‚é€šè¿‡æµå†™å…¥æ–‡ä»¶

\- (NSInteger)write:(const uint8_t *)buffer maxLength:(NSUInteger)len;

- ç¤ºä¾‹ï¼š

  - ä¸‹è½½å®Œå“åº”å¤´

```objc
//åˆå§‹åŒ–æµ
NSString *path = @"/Users/xxxxx/Desktop/4444.mp4";
self.stream = [NSOutputStream outputStreamToFileAtPath:path append:YES];
//æ‰“å¼€æµ å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ä¼šè‡ªåŠ¨åˆ›å»ºæ–‡ä»¶
[self.stream open];
```

  - ä¸‹è½½ç»“æŸæˆ–ä¸‹è½½å‡ºé”™ï¼Œå…³é—­æµ
  - ä¸‹è½½çš„è¿‡ç¨‹ä¸­ï¼Œå†™å…¥æ–‡ä»¶

  [self.stream write:data.bytes maxLength:data.length];

- é—®é¢˜ï¼š

  - å¦‚æœæ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œå†æ¬¡ä¸‹è½½çš„æ—¶å€™ä¼šè¿½åŠ æ–‡ä»¶

  - åœ¨æ–‡ä»¶ä¸‹è½½ä¹‹å‰ï¼Œå…ˆåˆ¤æ–­æ—¶å€™æœ‰æ–‡ä»¶ï¼Œå¦‚æœåˆ™åˆ é™¤é‡æ–°ä¸‹è½½

    - åˆ é™¤æ–‡ä»¶ï¼Œå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œæ­¤ä»£ç ä»€ä¹ˆéƒ½ä¸ä¼šæ‰§è¡Œ

 [[NSFileManager defaultManager] removeItemAtPath:path error:NULL];

### æ–­ç‚¹ç»­ä¼ 

- æ–‡ä»¶ä¸‹è½½çš„æ—¶å€™ä¸èƒ½åƒä¸Šæ–‡é‚£æ ·ï¼Œæ–‡ä»¶å­˜åœ¨ä¸èƒ½ç›´æ¥åˆ é™¤æ–‡ä»¶ã€‚åº”è¯¥åšä¸€äº›å†³ç­–
- åˆ¤æ–­æœ¬åœ°æ–‡ä»¶ï¼Œå¦‚æœæœ¬åœ°æ–‡ä»¶å­˜åœ¨è¦åˆ¤æ–­æ–‡ä»¶çš„å¤§å°

  - å¦‚æœæ²¡æœ‰æœ¬åœ°æ–‡ä»¶ï¼Œä¸‹è½½

  - å¦‚æœæœ¬åœ°æ–‡ä»¶å­˜åœ¨ï¼Œå‘é€Headè¯·æ±‚è·å–æœåŠ¡å™¨æ–‡ä»¶å¤§å°

    - æœ¬åœ°æ–‡ä»¶å¤§å°==æœåŠ¡å™¨æ–‡ä»¶å¤§å°ï¼Œä¸ä¸‹è½½
    - æœ¬åœ°æ–‡ä»¶å¤§å°< æœåŠ¡å™¨æ–‡ä»¶å¤§å°ï¼Œä»ä¹‹å‰çš„ä½ç½®å¼€å§‹ä¸‹è½½
    - æœ¬åœ°æ–‡ä»¶å¤§å°> æœåŠ¡å™¨æ–‡ä»¶å¤§å°ï¼Œåˆ é™¤æœ¬åœ°æ–‡ä»¶ï¼Œä»æ–°ä¸‹è½½
- Rangeï¼ˆ è¯·æ±‚å¤´å±æ€§ï¼‰é€šçŸ¥æœåŠ¡å™¨ä»å“ªé‡Œä¸‹åˆ°å“ªé‡Œ
  - Range: bytes=x-y ä»xå­—èŠ‚å¼€å§‹ä¸‹è½½ï¼Œä¸‹è½½åˆ°yå­—èŠ‚
  - Range: bytes=x-  ä»xå­—èŠ‚å¼€å§‹ä¸‹è½½ï¼Œç›´åˆ°æœ€å
  - Range: bytes=-y  ä»0å­—èŠ‚å¼€å§‹ä¸‹è½½ï¼Œä¸‹è½½åˆ°yå­—èŠ‚ã€

```objc
#import "DownloadManager.h"

@interface DownloadManager()<NSURLConnectionDataDelegate>
@property (nonatomic, assign) long long expectedContentLength;// æœåŠ¡å™¨è¦ä¸‹è½½æ–‡ä»¶å¤§å°
@property (nonatomic, assign) long long currentFileSize;// æœ¬åœ°å·²ä¸‹çš„æ–‡ä»¶å¤§å°
@property (nonatomic, strong) NSOutputStream *stream;// æµä¿å­˜,é˜²æ­¢å†…å­˜æš´å¢
@property (nonatomic, copy) NSString *saveFilePath;// è¦ä¿å­˜çš„ä½ç½®
// ä¸‹è½½é˜¶æ®µçš„å›è°ƒ
@property (nonatomic, copy) void (^successBlock)(NSString *path);
@property (nonatomic, copy) void (^processBlock)(float path);
@property (nonatomic, copy) void (^errorBlock)(NSError *error);
@end

@implementation DownloadManager

- (void)download:(NSString *)urlString successBlock:(nonnull void (^)(NSString * _Nonnull))successBlock processBlock:(nonnull void (^)(float))processBlock errorBlock:(nonnull void (^)(NSError * _Nonnull))errorBlock{
    self.successBlock = successBlock;
    self.processBlock = processBlock;
    self.errorBlock = errorBlock;
    NSURL *url = [NSURL URLWithString:urlString];
    [self getServerFileInfo:url];
    // å¦‚æœè¿”å›å€¼ä¸º -1 åˆ™è¡¨ç¤ºä¸‹è½½å®Œæˆ è¿”å› 0 åˆ™é‡å¤´ä¸‹è½½ å…¶ä»–å€¼åˆ™ä¸ºå·²ä¸‹è½½çš„æ–‡ä»¶å¤§å°
    self.currentFileSize = [self checkLoaclFIleInfo];
    if (self.currentFileSize == -1) {
        NSLog(@"finish");
        return;
    }
    [self downloadFile:url];
}

- (void)downloadFile:(NSURL*)url {
    [[NSOperationQueue new] addOperationWithBlock:^{
        NSMutableURLRequest *request = [NSMutableURLRequest requestWithURL:url];
        // ä»å½“å‰ä½ç½®ä¸‹è½½åˆ°æœ€å
        [request setValue:[NSString stringWithFormat:@"bytes=%lld-",self.currentFileSize] forHTTPHeaderField:@"Range"];
        // è¿™ä¸ªæ–¹æ³•æ˜¯åœ¨å½“å‰çº¿ç¨‹çš„æ¶ˆæ¯å¾ªç¯ä¸­ä¸‹è½½çš„ï¼Œæ‰€ä»¥è¦æŠŠä»–åŠ åœ¨å­çº¿ç¨‹ä¸­
        NSURLConnection *conn = [[NSURLConnection alloc] initWithRequest:request delegate:self];
        // å› ä¸ºå­çº¿ç¨‹çš„æ¶ˆæ¯å¾ªç¯é»˜è®¤æ˜¯å…³é—­çš„ï¼Œå› æ­¤åœ¨è®¾ç½®å¥½ä¸‹è½½åè¦å¼€å¯æ¶ˆæ¯å¾ªç¯
        [[NSRunLoop currentRunLoop] run];
    }];
}

- (void)getServerFileInfo:(NSURL*)url {
    // è·å¾—æœåŠ¡å™¨æ–‡ä»¶çš„ä¿¡æ¯
    NSMutableURLRequest *request = [NSMutableURLRequest requestWithURL:url];
    request.HTTPMethod = @"head";
    NSURLResponse *response;
    [NSURLConnection sendSynchronousRequest:request returningResponse:&response error:NULL];
    self.expectedContentLength = response.expectedContentLength;
    // è®¾ç½®ä¿å­˜çš„è·¯å¾„
    self.saveFilePath = [NSTemporaryDirectory() stringByAppendingPathComponent:response.suggestedFilename];
}
// è¿”å›å¼€å§‹ä¸‹è½½çš„ä½ç½®ï¼Œ-1åˆ™ä¸ºå·²ä¸‹è½½
- (long long)checkLoaclFIleInfo {
    long long fileSize = 0;
    NSFileManager *fileManager = [NSFileManager defaultManager];
    // åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨åˆ™è¿”å›é›¶ï¼Œä»å¼€å§‹ä½ç½®ä¸‹è½½
    if ([fileManager fileExistsAtPath:self.saveFilePath]) {
        // è·å–æ–‡ä»¶ä¿¡æ¯
        NSDictionary *fileInfo = [fileManager attributesOfItemAtPath:self.saveFilePath error:NULL];
        // NSFileManagerç»™å­—å…¸åšäº†åˆ†ç±»ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥æ‹¿åˆ°æ–‡ä»¶ä¿¡æ¯
        // æ‹¿åˆ°å½“å‰æ–‡ä»¶å¤§å°
        fileSize = fileInfo.fileSize;
        if (fileSize == self.expectedContentLength) {
            // å¦‚æœæœ¬åœ°æ–‡ä»¶å¤§å°å’ŒæœåŠ¡å™¨æ–‡ä»¶å¤§å°ä¸€è‡´åˆ™å·²ä¸‹è½½å®Œæˆï¼Œè¿”å›-1
            return -1;
        }
        if (fileSize > self.expectedContentLength) {
            // å¦‚æœæ–‡ä»¶å¤§å°å¤§äºæœåŠ¡å™¨æ–‡ä»¶å¤§å°ï¼Œè¡¨æ˜ä¸‹è½½å‡ºé”™ï¼Œè¦å…ˆåˆ é™¤æ–‡ä»¶åé‡æ–°ä¸‹è½½
            [fileManager removeItemAtPath:self.saveFilePath error:NULL];
            return 0;
        }
    }
    return fileSize;
}

// ä¸‹è½½çš„ä»£ç†æ–¹æ³•çš„å®ç°ï¼Œè¿™é‡Œç”¨NSOutputStreamè¿›è¡Œä¿å­˜
//æ¥æ”¶åˆ°å“åº”å¤´,å¼€å§‹ä¸‹è½½
- (void)connection:(NSURLConnection *)connection didReceiveResponse:(NSURLResponse *)response{
    self.stream = [NSOutputStream outputStreamToFileAtPath:self.saveFilePath append:YES];
    [self.stream open];
}
//æŒç»­æ¥æ”¶æ•°æ®
- (void)connection:(NSURLConnection *)connection didReceiveData:(NSData *)data{
    self.currentFileSize += data.length;
    if (self.processBlock) {
        [[NSOperationQueue mainQueue] addOperationWithBlock:^{
            self.processBlock(self.currentFileSize*1.0f/self.expectedContentLength);
        }];
    }
    [self.stream write:data.bytes maxLength:data.length];
    
}

//ä¸‹è½½å®Œæˆ
- (void)connectionDidFinishLoading:(NSURLConnection *)connection{
    [self.stream close];
    if (self.successBlock) {
        // å› ä¸ºé€šå¸¸æˆåŠŸéƒ½è¦æ”¹å˜domï¼Œæ‰€ä»¥å›åˆ°ä¸»çº¿ç¨‹ä¸­è°ƒç”¨
        [[NSOperationQueue mainQueue] addOperationWithBlock:^{
            self.successBlock(self.saveFilePath);
        }];
    }
}

//ä¸‹è½½å‡ºé”™
- (void)connection:(NSURLConnection *)connection didFailWithError:(NSError *)error{
    if (self.errorBlock) {
        [[NSOperationQueue mainQueue] addOperationWithBlock:^{
            self.errorBlock(error);
        }];
    }
}

@end
```

**æš‚åœ**ï¼š[self.conn cancel]; å…¶å®å°±æ˜¯å–æ¶ˆä¸‹è½½ï¼Œç„¶åç»§ç»­çš„æ—¶å€™å°±æ˜¯æ–­ç‚¹ç»­ä¼ 

## NSURLSession

NSURLConnection å·²ç»è¢«èˆå¼ƒäº†ï¼Œç”¨æ¥å®Œå…¨æ›¿ä»£USURLConnectionï¼Œå¯ä»¥ç†è§£ä¸ºå®˜æ–¹å¸®æˆ‘ä»¬å°è£…å¥½äº†URLConnectionï¼Œè®©æˆ‘ä»¬ä¸ç”¨å†å…³å¿ƒåº•å±‚çš„ä¸œè¥¿

- ä¹‹å‰å‘é€ç½‘ç»œè¯·æ±‚çš„è¿‡ç¨‹

- - URL --- URLRequest---URLConnection

- NSURLSession----iOS7.0ä»¥å

- - ç”¨äºæ›¿ä»£NSURLConnection
  - æ”¯æŒåå°è¿è¡Œçš„ç½‘ç»œä»»åŠ¡
  - æš‚åœã€åœæ­¢ã€é‡å¯ç½‘ç»œä»»åŠ¡ï¼Œä¸å†éœ€è¦è‡ªå·±å°è£…NSOperation
  - ä¸‹è½½ã€æ–­ç‚¹ç»­ä¼ ã€å¼‚æ­¥ä¸‹è½½
  - ä¸Šä¼ ã€å¼‚æ­¥ä¸Šä¼ 
  - è·å–ä¸‹è½½ã€ä¸Šä¼ çš„è¿›åº¦

- NSURLSessionå¯ä»¥å‘èµ·ä»¥ä¸‹ä»»åŠ¡ï¼Œé»˜è®¤æ‰€æœ‰çš„ä»»åŠ¡éƒ½æ˜¯æŒ‚èµ·çš„

- - DataTask   UploadTask
  - DownloadTask

- NSURLSessionConfigration

- - ç»Ÿä¸€é…ç½®è¯·æ±‚çš„ä¿¡æ¯

### GET

```objc
NSURL *url = [NSURL URLWithString:@"http://192.168.1.6/aaa/demo.json"];
    // sessionä»»åŠ¡éƒ½æ˜¯é»˜è®¤æŒ‚èµ·çš„ï¼ˆæ²¡æœ‰è°ƒç”¨ï¼‰
    NSURLSessionDataTask *task = [[NSURLSession sharedSession] dataTaskWithURL:url completionHandler:^(NSData * _Nullable data, NSURLResponse * _Nullable response, NSError * _Nullable error) {
        if (error) {
            NSLog(@"connection error");
            return;
        }
        NSHTTPURLResponse *httpRes = (NSHTTPURLResponse*)response;
        if (httpRes.statusCode != 200 && httpRes.statusCode != 304) {
            NSLog(@"server error");
            return;
        }
        
        NSDictionary *dict = [NSJSONSerialization JSONObjectWithData:data options:0 error:NULL];
        NSLog(@"%@",dict);
    }];
    // å¼€å¯ä½¿ç”¨task
    [task resume];
```

### POST

```objc
NSURL *url = [NSURL URLWithString:@"http://192.168.1.6/login.php"];
    // sessionä»»åŠ¡éƒ½æ˜¯é»˜è®¤æŒ‚èµ·çš„ï¼ˆæ²¡æœ‰è°ƒç”¨ï¼‰
    NSMutableURLRequest *request = [NSMutableURLRequest requestWithURL:url];
    request.HTTPMethod = @"post";
    NSString *body = @"username=zhangsan&password=zhang";
    request.HTTPBody = [body dataUsingEncoding:NSUTF8StringEncoding];
    [[[NSURLSession sharedSession] dataTaskWithRequest:request completionHandler:^(NSData * _Nullable data, NSURLResponse * _Nullable response, NSError * _Nullable error) {
        if (error) {
            NSLog(@"connection error");
            return;
        }
        NSHTTPURLResponse *httpRes = (NSHTTPURLResponse*)response;
        if (httpRes.statusCode != 200 && httpRes.statusCode != 304) {
            NSLog(@"server error");
            return;
        }
        NSDictionary *dict = [NSJSONSerialization JSONObjectWithData:data options:0 error:NULL];
        NSLog(@"%@",dict);
    }] resume];
```

### Sessionå†…å­˜ç®¡ç†

å¦‚æœä¸ç”¨shareçš„å•ä¾‹ï¼Œè‡ªå®šä¹‰sessionçš„è¯å› ä¸ºé€šå¸¸è‡ªå®šä¹‰éƒ½æ˜¯ä¸ºäº†è®¾ç½®ä»£ç†ï¼Œæ‰€ä»¥ä¼šå‘ç”Ÿå†…å­˜æ³„æ¼é—®é¢˜

@property (nonatomic, strong) NSURLSession *session;

-  å¦‚æœè®¾ç½®ä»£ç†ï¼Œå¦‚æœä»£ç†æŒ‡å‘selfï¼Œè€Œè¿™é‡Œçš„sessionåˆç”¨å¼ºæŒ‡é’ˆçš„è¯å°±ä¼šå‘ç”Ÿå¾ªç¯å¼•ç”¨
-  ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåœ¨controllerç”Ÿå‘½å‘¨æœŸçš„æœ€åè°ƒç”¨ 
   -  [self.session invalidateAndCancel];
-   propertyå±æ€§ä¹Ÿä¸èƒ½æ”¹æˆå¼±æŒ‡é’ˆçš„ä¸ç„¶åˆå§‹åŒ–å®Œå°±è‡ªåŠ¨é”€æ¯äº†

```objc
// é˜²æ­¢å¾ªç¯å¼•ç”¨å¯¼è‡´è¿™ä¸ªæ§åˆ¶å™¨å†…å­˜æ³„æ¼,æ§åˆ¶å™¨å°†è¦æ¶ˆå¤±çš„ç”Ÿå‘½å‘¨æœŸ
- (void)viewDidDisappear:(BOOL)animated{
    [super viewDidDisappear:animated];
    [self.session invalidateAndCancel];
}
```

### ä¸‹è½½

æ— è®ºæ˜¯ç”¨ä»£ç†çš„æ–¹å¼ä¸‹è½½è¿˜æ˜¯ç›´æ¥ç”¨blockä¸‹è½½ï¼Œæ–‡ä»¶ä¸‹è½½å¥½ä¹‹åï¼ˆæ‰§è¡Œå®Œblockå›è°ƒæˆ–è€…ä¸‹è½½å®Œæˆçš„ä»£ç†æ–¹æ³•ï¼‰éƒ½ä¼šåˆ é™¤ï¼Œå¦‚æœè¿™ä¸ªæ–‡ä»¶æƒ³é‡å¤ç”¨å¯ä»¥è‡ªå·±åœ¨ä¸‹è½½å¥½åå¤åˆ¶ä¸€ä»½ä¿å­˜èµ·æ¥ï¼Œå¦‚æœåªç”¨ä¸€æ¬¡ï¼Œé‚£ä¹ˆæŠŠå®ƒåŠ è½½åˆ°å†…å­˜ä¸­å°±å¥½äº†

ç›´æ¥ä¸‹è½½ï¼Œæ— æ³•è·å–ä¸‹è½½çš„çŠ¶æ€ï¼Œåªæœ‰ä¸‹è½½çš„ç»“æœã€‚

```objc
[[[NSURLSession sharedSession] downloadTaskWithURL:[NSURL URLWithString:@"http://192.168.1.6/1.zip"] completionHandler:^(NSURL * _Nullable location, NSURLResponse * _Nullable response, NSError * _Nullable error) {
    // é»˜è®¤blockæ˜¯åœ¨å­çº¿ç¨‹ä¸­æ‰§è¡Œçš„
    NSLog(@"%@",location);
    // å¤åˆ¶æ–‡ä»¶åˆ°å…¶ä»–ä½ç½®ï¼Œä¸ç„¶æ–‡ä»¶ä¼šè‡ªåŠ¨åˆ é™¤ã€‚
    NSString *fileInTmp = [NSTemporaryDirectory() stringByAppendingPathComponent:@"test.zip"];
    [[NSFileManager defaultManager] copyItemAtPath:location.path toPath:fileInTmp error:NULL];
}] resume];
```

è·å–ä¸‹è½½ä¿¡æ¯ï¼Œå°±ä¸ç”¨sharedSessionè¿™ä¸ªå•ä¾‹ï¼Œæˆ‘ä»¬è‡ªå·±åˆ›å»ºä¸€ä¸ªsessionç„¶åè®¾ç½®ä»£ç†ï¼Œéµå®ˆ\<NSURLSessionDownloadDelegate\>åè®®

```objc
@property (nonatomic, strong) NSURLSession *session;
- (NSURLSession *)session{
    if (!_session) {
        NSURLSessionConfiguration *config = [NSURLSessionConfiguration defaultSessionConfiguration];
        _session = [NSURLSession sessionWithConfiguration:config delegate:self delegateQueue:[NSOperationQueue mainQueue]];
    }
    return _session;
}
- (void)downloadTaskWithProcess {
    // ç”¨ä»£ç†çš„æ–¹å¼å°±ä¸èƒ½ç”¨blockçš„æ–¹æ³•ï¼Œä¼šå†²çªï¼Œåªæ‰§è¡Œblockä¸æ‰§è¡Œä»£ç†æ–¹æ³•
    [[self.session downloadTaskWithURL:[NSURL URLWithString:@"http://192.168.1.6/1.zip"]] resume];
}
// å¼€å§‹ç»­ä¼ çš„æ—¶å€™è°ƒç”¨çš„æ–¹æ³•
- (void)URLSession:(NSURLSession *)session downloadTask:(NSURLSessionDownloadTask *)downloadTask didResumeAtOffset:(int64_t)fileOffset expectedTotalBytes:(int64_t)expectedTotalBytes{
    NSLog(@"ç»­ä¼ ");
}
// è·å–è¿›åº¦
- (void)URLSession:(NSURLSession *)session downloadTask:(NSURLSessionDownloadTask *)downloadTask didWriteData:(int64_t)bytesWritten totalBytesWritten:(int64_t)totalBytesWritten totalBytesExpectedToWrite:(int64_t)totalBytesExpectedToWrite{
    float process = totalBytesWritten * 1.0f / totalBytesExpectedToWrite;
    NSLog(@"%.2f%%",process);
}
// ä¸‹è½½å®Œæˆ
- (void)URLSession:(NSURLSession *)session downloadTask:(NSURLSessionDownloadTask *)downloadTask didFinishDownloadingToURL:(NSURL *)location{
    NSLog(@"finish");
}

```

### æ–­ç‚¹ç»­ä¼ 

- åœ¨ç•Œé¢ä¸Šæ”¾ä¸€ä¸ªscrollViewæ‹–åŠ¨çš„æ—¶å€™ï¼Œä¸‹è½½ä»»åŠ¡ä¸ä¼šåœæ­¢
- åŸå› ï¼š

  - ä¸‹è½½ä»»åŠ¡æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ï¼ˆå³ä½¿æŠŠä»£ç†æ–¹æ³•æ·»åŠ åˆ°ä¸»é˜Ÿåˆ—ä¸­ï¼‰
  - å½“å‘ç”Ÿåˆé€‚çš„äº‹ä»¶åï¼Œé€šçŸ¥ä»£ç†å¯¹è±¡
  - æ‰€æœ‰çš„ä»£ç†æ–¹æ³•éƒ½æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸Šå¼‚æ­¥æ‰§è¡Œçš„ï¼ˆä»»åŠ¡æ·»åŠ åˆ°ä¸»é˜Ÿåˆ—çš„æ—¶å€™ï¼‰
    - \<NSURLSessionDownloadDelegate\>
- æ‹–åŠ¨scrollViewçš„æ—¶å€™ä¸‹è½½ä¸ä¼šåœæ­¢
- åˆ›å»ºsessionçš„æ—¶å€™ï¼Œé˜Ÿåˆ—è®¾ç½®ä¸ºnilï¼Œå’Œå†™[[NSOperationQueue alloc] init]çš„æ•ˆæœæ˜¯ä¸€æ ·çš„

_session = [NSURLSession sessionWithConfiguration:config delegate:self delegateQueue:nil];

- é˜Ÿåˆ—çš„é€‰æ‹©

  - å¦‚æœä¸‹è½½å®Œæˆåæ›´æ–°ä¸»ç•Œé¢ä½¿ç”¨ä¸»é˜Ÿåˆ—
  - å¦‚æœä¸‹è½½å®Œæˆåæ‰§è¡Œåç»­æ“ä½œã€‚ä½¿ç”¨æ–°é˜Ÿåˆ—

```objc
#import <WebKit/WebKit.h>
#import "ViewController.h"
@interface ViewController ()<NSURLSessionDownloadDelegate>

@property (nonatomic, strong) NSURLSession *session;
@property (nonatomic, strong) NSURLSessionDownloadTask *downloader;
@property (nonatomic, strong) NSData *resumeData;
@property (weak, nonatomic) IBOutlet UIProgressView *progressView;

@end

@implementation ViewController

- (NSURLSession *)session{
    if (!_session) {
        NSURLSessionConfiguration *config = [NSURLSessionConfiguration defaultSessionConfiguration];
        // ä»£ç†æ–¹æ³•åœ¨ä¸»é˜Ÿåˆ—ä¸­æ‰§è¡Œï¼Œè¿™æ ·å°±å¯ä»¥æ–¹ä¾¿æ§åˆ¶UIæ§ä»¶ï¼Œè™½ç„¶ä»£ç†æ–¹æ³•æ˜¯ä¸»é˜Ÿåˆ—ä¸­æ‰§è¡Œï¼Œä½†æ˜¯ä¸‹è½½è¿˜æ˜¯å¼‚æ­¥ä¸‹è½½çš„ï¼Œå› æ­¤ä¸ç”¨æ‹…å¿ƒä¼šå¡ä½é¡µé¢
        _session = [NSURLSession sessionWithConfiguration:config delegate:self delegateQueue:[NSOperationQueue mainQueue]];
    }
    return _session;
}

- (void)viewDidLoad {
    [super viewDidLoad];
    
}
// é˜²æ­¢å¾ªç¯å¼•ç”¨å¯¼è‡´è¿™ä¸ªæ§åˆ¶å™¨å†…å­˜æ³„æ¼
- (void)viewDidDisappear:(BOOL)animated{
    [super viewDidDisappear:animated];
    [self.session invalidateAndCancel];
    self.session=nil;
}
// sbçš„å¼€å§‹æŒ‰é’®ç›‘å¬çš„æ–¹æ³•
- (IBAction)start:(id)sender {
    [self downloadTaskWithProcess];
}
// sbçš„æš‚åœæŒ‰é’®ç›‘å¬çš„æ–¹æ³•
- (IBAction)pause:(id)sender {
    [self.downloader cancelByProducingResumeData:^(NSData * _Nullable resumeData) {
        // å…¶å®è¿™é‡Œçš„resumeDataåªæ˜¯ç»­ä¼ çš„ä¸€äº›ä¿¡æ¯ï¼Œè€Œä¸æ˜¯çœŸæ­£çš„æ•°æ®ï¼ˆåŸæœ¬çš„æ•°æ®æ˜¯ç³»ç»Ÿè‡ªåŠ¨å¸®æˆ‘ä»¬å¸¸è§çš„ä¸´æ—¶æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶ä¸ç”¨æˆ‘ä»¬è‡ªå·±å¤„ç†ï¼‰, NSURLSession åªè¦è¯»å–åˆ°è¿™äº›ä¿¡æ¯å°±å¯ä»¥ç»§ç»­ä¸‹è½½äº†ï¼Œ
        self.resumeData = resumeData;
        // æš‚åœåå§æ•°æ®ä¿å­˜è¿›æ²™ç›’ï¼Œè¿™æ ·ç”¨æˆ·é‡å¯appçš„æ—¶å€™å°±ä¸æ€•æ•°æ®ä¸¢å¤±
        NSString *path = [NSTemporaryDirectory() stringByAppendingPathComponent:@"test"];
        [self.resumeData writeToFile:path atomically:YES];
        // ä¸ºäº†é˜²æ­¢å¤šæ¬¡ç‚¹å‡»åœæ­¢ï¼ŒåresumeDataé‡ç½®ä¸ºnull
        self.downloader = nil;
    }];
    
}
// sbçš„ç»§ç»­æŒ‰é’®ç›‘å¬çš„æ–¹æ³•
- (IBAction)goOn:(id)sender {
    // ä»æ²™ç›’ä¸­è¯»å–æ–‡ä»¶
    NSString *path = [NSTemporaryDirectory() stringByAppendingPathComponent:@"test"];
    [self.resumeData writeToFile:path atomically:YES];
    NSFileManager *fileManager = [NSFileManager defaultManager];
    // åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨
    if ([fileManager fileExistsAtPath:path]) {
        self.resumeData = [NSData dataWithContentsOfFile:path];
    }
    if (self.resumeData = nil) return;
    self.downloader = [self.session downloadTaskWithResumeData:self.resumeData];
    [self.downloader resume];
}

- (void)downloadTaskWithProcess {
    NSURLSessionDownloadTask *downloader = [self.session downloadTaskWithURL:[NSURL URLWithString:@"http://192.168.1.6/1.zip"]];
    self.downloader = downloader;
    [self.downloader resume];
}
// å¼€å§‹ç»­ä¼ çš„æ—¶å€™è°ƒç”¨çš„æ–¹æ³•
- (void)URLSession:(NSURLSession *)session downloadTask:(NSURLSessionDownloadTask *)downloadTask didResumeAtOffset:(int64_t)fileOffset expectedTotalBytes:(int64_t)expectedTotalBytes{
    NSLog(@"ç»­ä¼ ");
}
// è·å–è¿›åº¦
- (void)URLSession:(NSURLSession *)session downloadTask:(NSURLSessionDownloadTask *)downloadTask didWriteData:(int64_t)bytesWritten totalBytesWritten:(int64_t)totalBytesWritten totalBytesExpectedToWrite:(int64_t)totalBytesExpectedToWrite{
    float process = totalBytesWritten * 1.0f / totalBytesExpectedToWrite;
    // progressViewæ˜¯ç³»ç»Ÿé»˜è®¤çš„è¿›åº¦æ¡æ§ä»¶ï¼Œç”¨å®ƒæ¥æ˜¾ç¤ºè¿›åº¦
    // å› ä¸ºä»£ç†æ”¾å…¥äº†ä¸»é˜Ÿåˆ—ä¸­æ‰€ä»¥å¯ä»¥ç›´æ¥æ“ä½œUI
    self.progressView.progress = process;
    NSLog(@"%f",process);
}
// ä¸‹è½½å®Œæˆ
- (void)URLSession:(NSURLSession *)session downloadTask:(NSURLSessionDownloadTask *)downloadTask didFinishDownloadingToURL:(NSURL *)location{
    // ä¸‹è½½å¥½åä¿å­˜æ–‡ä»¶
    //NSString *fileInTmp = [NSTemporaryDirectory() stringByAppendingPathComponent:@"111.zip"];
    //[[NSFileManager defaultManager] copyItemAtPath:location.path toPath:fileInTmp error:NULL];
    // ç”¨ç¬¬ä¸‰æ–¹æ¡†æ¶ SSZuoArcguve ä¸‹è½½å¥½åç›´æ¥å¸®æˆ‘ä»¬è§£å‹åˆ°æŒ‡å®šç›®å½•
    [SSZipArchive unzipFileAtPath:location.path toDestination:NSTemporaryDirectory() uniqueId:nil];
    // æŠŠæŒ‡å®šæ–‡ä»¶ç›®å½•å‹ç¼©åˆ°ä¸€ä¸ªæŒ‡å®šçš„åœ°æ–¹
    // [SSZipArchive createZipFileAtPath:[NSTemporaryDirectory() stringByAppendingPathComponent:@"test.zip"] withContentsOfDirectory:[NSTemporaryDirectory() stringByAppendingPathComponent:@"pro"]];
    NSLog(@"finish");
}
@end
```

#### å‹ç¼©è§£å‹çš„ç¬¬ä¸‰æ–¹æ’ä»¶

SSZipArchive ç›´æ¥githubä¸‹è½½å°±å¥½äº†

```objc
// ç”¨ç¬¬ä¸‰æ–¹æ¡†æ¶ SSZuoArcguve æŠŠæ–‡ä»¶è§£å‹åˆ°æŒ‡å®šç›®å½•
[SSZipArchive unzipFileAtPath:location.path toDestination:NSTemporaryDirectory() uniqueId:nil];
// æŠŠæŒ‡å®šæ–‡ä»¶ç›®å½•å‹ç¼©åˆ°ä¸€ä¸ªæŒ‡å®šçš„åœ°æ–¹
[SSZipArchive createZipFileAtPath:[NSTemporaryDirectory() stringByAppendingPathComponent:@"test.zip"] withContentsOfDirectory:[NSTemporaryDirectory() stringByAppendingPathComponent:@"pro"]];
```

### ä¸Šä¼ æ–‡ä»¶

- æ¼”ç¤ºHTTPçš„Methodï¼ŒPUT  GET  DElETE ï¼ˆå‰ææ˜¯æœåŠ¡å™¨æœ‰ä¸€ä¸ªæ–‡ä»¶æœåŠ¡å™¨ä¾›æˆ‘ä»¬æ“ä½œï¼Œè¿™é‡Œæˆ‘ä½¿ç”¨çš„æ˜¯Apacheçš„webDavä½œä¸ºæœåŠ¡å™¨ï¼‰

- PUT ä¸Šä¼ 

  - putç›´æ¥ä»¥æ–‡ä»¶çš„æ–¹å¼å†™å…¥
  - postéœ€è¦æœåŠ¡å™¨ç«¯è„šæœ¬æ”¯æŒ
  - putä¸Šä¼ æˆåŠŸï¼ˆ201 åˆ™ä¸ºæˆåŠŸåˆ›å»ºï¼‰ ï¼ˆ204 ä¸ºæ“ä½œæˆåŠŸä»€ä¹ˆéƒ½ä¸è¿”å›ï¼Œé€šå¸¸æ˜¯ä¿®æ”¹æ–‡ä»¶çš„è¿”å›å€¼ï¼‰

- é€šè¿‡sessionå‘é€putè¯·æ±‚ä¸Šä¼ æ–‡ä»¶

  - å¦‚æœç›´æ¥ä¸Šä¼ è¿”å›çŠ¶æ€ç 401 --æ²¡æœ‰æˆæƒ

  - å› ä¸ºWebDavè®¾ç½®äº†åŸºæœ¬èº«ä»½éªŒè¯ï¼Œæ‰€ä»¥è¯·æ±‚çš„æ—¶å€™å¾—æºå¸¦éªŒè¯çš„å­—ç¬¦ä¸²

  - è‡ªå·±ä¸Šä¼ æˆ–åˆ é™¤ä¸€ä¸ªæ–‡ä»¶ï¼Œç”¨charlesç›‘è§†è¯·æ±‚ï¼Œçœ‹è¯·æ±‚ä¸­çš„å†…å®¹

    - è¯·æ±‚å¤´æœ‰ä¸€é¡¹Authorization: Basic YWRtaW46MTIzNDU2
    - YWRtaW46MTIzNDU2 æ˜¯base64 ç¼–ç çš„è´¦å·å’Œå¯†ç 
    - é€šè¿‡base64è§£ç è¿˜åŸ admin:123456
    - å¸¸ç”¨çš„è¯·æ±‚å¤´

      - postæ—¶å€™çš„Content-Typeã€Rangeã€User-Agentã€Authorization
  - ç®€å•çš„putæ–¹æ³•åº”ç”¨

  ```objc
  - (void)uploadTask {
      // è¦å†™å…¥æœåŠ¡å™¨çš„è·¯å¾„å’Œåœ°å€
      NSURL *url = [NSURL URLWithString:@"http://192.168.1.6/uploads/test.js"];
      // è¦ä¸Šä¼ çš„æ–‡ä»¶åœ°å€
      NSURL *fileUrl = [NSURL fileURLWithPath:@"/Users/xxx/Desktop/test.js"];
      NSMutableURLRequest *request = [NSMutableURLRequest requestWithURL:url];
      // è®¾ç½®è¯·æ±‚æ–¹æ³•å’Œè®¾ç½®å“åº”å¤´
      request.HTTPMethod = @"put";
      //YWRtaW46MTIzNDU2 å…¶å®å°±æ˜¯ base64 ç¼–ç  è§£ç åå°±æ˜¯ é…ç½®webDavæ—¶çš„ç”¨æˆ·åå’Œå¯†ç  ç”¨æˆ·å:å¯†ç 
      //Authorization: Basic YWRtaW46MTIzNDU2
      [request setValue:[self getAuthorizationValueWithuser:@"admin" pwd:@"123456"] forHTTPHeaderField:@"Authorization"];
      // ä¸Šä¼ å®Œæˆåçš„å›è°ƒ
      [[[NSURLSession sharedSession] uploadTaskWithRequest:request fromFile:fileUrl completionHandler:^(NSData * _Nullable data, NSURLResponse * _Nullable response, NSError * _Nullable error) {
          if (error) {
              NSLog(@"connection error");
              return;
          }
          NSString *str = [[NSString alloc] initWithData:data encoding:NSUTF8StringEncoding];
          NSLog(@"%@",str);
      }] resume];
  }
  // æ‹¼æ¥å“åº”å¤´çš„æ–¹æ³•
  - (NSString*)getAuthorizationValueWithuser:(NSString*)name pwd:(NSString*)pwd{
      NSString *value = [self base64Encode:[NSString stringWithFormat:@"%@:%@", name, pwd]];
      return [NSString stringWithFormat:@"Basic %@",value];
  }
  
  - (NSString*)base64Encode:(NSString*)str{
      NSData *data = [str dataUsingEncoding:NSUTF8StringEncoding];
      return [data base64EncodedStringWithOptions:0];
  }
  ```

  - ç”¨ä»£ç†å¯¹ä¸Šä¼ çš„ä¸€äº›äº‹ä»¶è¿›è¡Œå¤„ç†ï¼Œputä¸Šä¼ çš„ä»£ç†æ–¹æ³•\<NSURLSessionTaskDelegate\>

  ```objc
  #import <WebKit/WebKit.h>
  #import "ViewController.h"
  #import "SSZipArchive.h"
  @interface ViewController ()<NSURLSessionTaskDelegate>
  @property (weak, nonatomic) IBOutlet UIProgressView *progressView;
  
  @property (nonatomic, strong) NSURLSession *session;
  @end
  
  @implementation ViewController
  
  - (NSURLSession *)session{
      if(!_session) {
          NSURLSessionConfiguration *config = [NSURLSessionConfiguration  defaultSessionConfiguration];
          _session = [NSURLSession sessionWithConfiguration:config delegate:self delegateQueue:[NSOperationQueue mainQueue]];
      }
      return _session;
  }
  
  - (void)viewDidLoad {
      [super viewDidLoad];
  }
  // é˜²æ­¢å¾ªç¯å¼•ç”¨å¯¼è‡´è¿™ä¸ªæ§åˆ¶å™¨å†…å­˜æ³„æ¼
  - (void)viewDidDisappear:(BOOL)animated{
      [super viewDidDisappear:animated];
      [self.session invalidateAndCancel];
      self.session=nil;
  }
  - (void)touchesBegan:(NSSet<UITouch *> *)touches withEvent:(UIEvent *)event{
      [self uploadTask];
  }
  
  - (void)uploadTask {
      NSURL *url = [NSURL URLWithString:@"http://192.168.1.6/uploads/Information.pdf"];
      NSURL *fileUrl = [NSURL fileURLWithPath:@"/Users/duzuhua/Desktop/Information.pdf"];
      NSMutableURLRequest *request = [NSMutableURLRequest requestWithURL:url];
      request.HTTPMethod = @"put";
      //YWRtaW46MTIzNDU2 å…¶å®å°±æ˜¯ base64 ç¼–ç  è§£ç åå°±æ˜¯ é…ç½®webDavæ—¶çš„ç”¨æˆ·åå’Œå¯†ç  ç”¨æˆ·å:å¯†ç 
      //Authorization: Basic YWRtaW46MTIzNDU2
      [request setValue:[self getAuthorizationValueWithuser:@"admin" pwd:@"123456"] forHTTPHeaderField:@"Authorization"];
      [[self.session uploadTaskWithRequest:request fromFile:fileUrl] resume];
  }
  
  - (NSString*)getAuthorizationValueWithuser:(NSString*)name pwd:(NSString*)pwd{
      NSString *value = [self base64Encode:[NSString stringWithFormat:@"%@:%@", name, pwd]];
      return [NSString stringWithFormat:@"Basic %@",value];
  }
  
  - (NSString*)base64Encode:(NSString*)str{
      NSData *data = [str dataUsingEncoding:NSUTF8StringEncoding];
      return [data base64EncodedStringWithOptions:0];
  }
  // ä¸Šä¼ è¿›åº¦
  - (void)URLSession:(NSURLSession *)session task:(NSURLSessionTask *)task didSendBodyData:(int64_t)bytesSent totalBytesSent:(int64_t)totalBytesSent totalBytesExpectedToSend:(int64_t)totalBytesExpectedToSend{
      // å› ä¸ºä»£ç†æ–¹æ³•æ˜¯ä¸»é˜Ÿåˆ—ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥æ“ä½œUI
      float progress = totalBytesSent * 1.0f /totalBytesExpectedToSend;
      self.progressView.progress = progress;
  }
  // ä¸Šä¼ å®Œæˆåçš„æ–¹æ³•
  - (void)URLSession:(NSURLSession *)session task:(NSURLSessionTask *)task didCompleteWithError:(NSError *)error{
      NSLog(@"ä¸Šä¼ å®Œæˆ");
  }
  @end
  ```

### åˆ é™¤æ–‡ä»¶

æˆåŠŸçš„çŠ¶æ€ç ä¸º204 (è¡¨ç¤ºæ“ä½œæˆåŠŸä»€ä¹ˆéƒ½ä¸è¿”å›)

```objc
- (void)deleteFile{
    NSURL *url = [NSURL URLWithString:@"http://192.168.1.6/uploads/Information.pdf"];
    NSMutableURLRequest *request = [NSMutableURLRequest requestWithURL:url];
    request.HTTPMethod = @"delete";
    [request setValue:[self getAuthorizationValueWithuser:@"admin" pwd:@"123456"] forHTTPHeaderField:@"Authorization"];
    [[[NSURLSession sharedSession] dataTaskWithRequest:request completionHandler:^(NSData * _Nullable data, NSURLResponse * _Nullable response, NSError * _Nullable error) {
        
        NSString *str = [[NSString alloc] initWithData:data encoding:NSUTF8StringEncoding];
        NSLog(@"åˆ é™¤æˆåŠŸ%@",str);
        NSLog(@"%@",response);
    }] resume];
}
```

### NSURLSessionConfiguration

- NSURLSessionConfigurationä½œç”¨

  - å¯ä»¥è®¾ç½®è¯·æ±‚å¤´(Content-Type  Range User-Agent Authorizationç­‰)
  - å¯ä»¥è®¾ç½®æœ€å¤§è¿æ¥æ•°
  - å¯ä»¥è®¾ç½®è¶…æ—¶æ—¶é•¿ï¼Œç¼“å­˜ç­–ç•¥
- ç±»æ–¹æ³•ï¼Œåˆ›å»ºå¯¹è±¡

  - defaultSessionConfiguration  

    - ä¼šä½¿ç”¨ç£ç›˜ç¼“å­˜ï¼Œè´¦æˆ·ä¿¡æ¯å­˜å‚¨åˆ°é’¥åŒ™é“¾ï¼Œå¦‚æœæœ‰cookieä¼šæºå¸¦cookie

  - ephemeralSessionConfiguration

    - æ²¡æœ‰ç£ç›˜ç¼“å­˜ï¼Œä¸å­˜å‚¨è´¦æˆ·ä¿¡æ¯ï¼Œä¸æºå¸¦cookie
    - æ•°æ®å­˜å‚¨åœ¨å†…å­˜ï¼Œé€Ÿåº¦å¿«ï¼Œå¦‚æœè¦å­˜å‚¨åˆ°ç£ç›˜éœ€è¦è‡ªå·±å†™

  - backgroundSessionConfigurationWithIdentifier

    - åœ¨ä¸€ä¸ªå•ç‹¬çš„è¿›ç¨‹ä¸Šä¸‹è½½
    - appè¿›å…¥åå°æˆ–ç»ˆæ­¢ä¹‹åï¼Œä¾ç„¶å¯ä»¥ç»§ç»­ä¸‹è½½
- å±æ€§

  - HTTPAdditionalHeadersï¼šæ·»åŠ è¯·æ±‚å¤´
  - requestCachePolicyï¼šç¼“å­˜ç­–ç•¥
  - timeoutIntervalForRequestï¼šè¯·æ±‚çš„è¶…æ—¶æ—¶é•¿
  - allowsCellularAccessï¼šè¿è¡Œèœ‚çªç½‘ç»œè®¿é—®
  - HTTPMaximumConnectionsPerHostï¼šä¸»æœºçš„æœ€å¤§è¿æ¥æ•°
- æ¼”ç¤º

```objc
NSURLSessionConfiguration *config = [NSURLSessionConfiguration defaultSessionConfiguration];
// å“åº”å¤´å¯ä»¥ç›´æ¥ä¼ ä¸€ä¸ªå­—å…¸ï¼Œä¸ç”¨kvcçš„æ–¹å¼
config.HTTPAdditionalHeaders = @{@"Authorization":[self getAuthorizationStr]};
```



## HTTPS

HTTPSæ˜¯ä¸€ç§å¯†æ–‡åŠ å¯†åçš„HTTPåè®®ï¼Œæœ€åä¸€ä¸ªå­—æ¯ S æŒ‡çš„æ˜¯ SSL/TLS åè®®ï¼Œå®ƒä½äº HTTP åè®®ä¸ TCP/IP åè®®ä¸­é—´ã€‚HTTPSçš„é€šä¿¡æ–¹å¼å°±å‘ç”Ÿäº†äº›è®¸å˜åŒ–ï¼Œå³å‘é€è¯·æ±‚å‰è¿›è¡Œhttpsçš„åå•†

1. ä¿¡ä»»æœåŠ¡å™¨è¿”å›çš„è¯ä¹¦ï¼ˆå…¬é’¥ï¼‰
2. å®¢æˆ·ç«¯äº§ç”Ÿéšæœºçš„ç§˜é’¥
3. å…¬é’¥å¯¹éšæœºçš„ç§˜é’¥è¿›è¡Œå¯¹ç§°åŠ å¯†ï¼ˆä¹Ÿå°±æ˜¯ä¸Šæ–‡åŠ å¯†ä¸­çš„rsaï¼‰
4. æŠŠå…¬é’¥åŠ å¯†åçš„éšæœºç§˜é’¥å‘é€ç»™æœåŠ¡å™¨
5. ä½¿ç”¨éšæœºç§˜é’¥åŠ å¯†æ•°æ®å’ŒæœåŠ¡å™¨äº¤äº’

ä¸‹é¢è¿™æ®µä»£ç åªåœ¨ä¸€äº›è€ç‰ˆæœ¬çš„åŠ å¯†åè®®æ‰ä¼šç”¨åˆ°ï¼Œå¦‚æœurlåœ°å€æ˜¯https ä½†æ˜¯åˆæŠ¥äº†ä¸€ä¸ªé”™æ˜¯...-SSLçš„ï¼Œé‚£å°±éµå®ˆä»£ç†ï¼ŒpliståŠ ä¸Šatsã€‚

```objc
// è¦éµå®ˆä»£ç† NSURLSessionDataDelegateï¼Œæˆ–è€…å‡†å®ˆäº†è¿™ä¸ªä»£ç†çš„ä»£ç†æ¯”å¦‚ NSURLSessionTaskDelegate
- (void)URLSession:(NSURLSession *)session didReceiveChallenge:(NSURLAuthenticationChallenge *)challenge completionHandler:(void (^)(NSURLSessionAuthChallengeDisposition, NSURLCredential * _Nullable))completionHandler{
    // åˆ¤æ–­è¯ä¹¦çš„åŠ å¯†æ–¹å¼ï¼ˆæ˜¯å¯†ç åŠ å¯†è¿˜æ˜¯è¯ä¹¦è®¤è¯ï¼‰
    if (challenge.protectionSpace.authenticationMethod == NSURLAuthenticationMethodServerTrust) {
        // è®¾ç½®ä¿¡ä»»æœåŠ¡å™¨è¯ä¹¦
        NSURLCredential *credential = [NSURLCredential credentialForTrust:challenge.protectionSpace.serverTrust];
        completionHandler(0,credential);
    }
}
```



